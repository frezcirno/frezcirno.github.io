<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin=""><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222"><link rel="manifest" href="/images/site.webmanifest"><meta name="google-site-verification" content="_2IFmyB6MWp-By-cUpcYN7YPQVlR79Myfqb8mKJvGY8"><meta name="msvalidate.01" content="18B2BF72408DBD213F31F967D458F288"><style>:root{--body-bg-color:#eee;--content-bg-color:#fff;--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#fff;--highlight-foreground:#24292e;--highlight-gutter-background:#fff;--highlight-gutter-foreground:#393e42;--lightningcss-light:initial;color-scheme:light}@media (prefers-color-scheme:dark){:root{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--selection-bg:#bbb;--selection-color:#333;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--theme-color:#222;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#0d1117;--highlight-foreground:#c9d1d9;--highlight-gutter-background:#1f242a;--highlight-gutter-foreground:#b6bdc5;--lightningcss-dark:initial;color-scheme:dark}img{opacity:.75}img:hover{opacity:.9}iframe{--lightningcss-light:initial;color-scheme:light}}html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{margin:.67em 0;font-size:2em}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background:0 0}abbr[title]{border-bottom:none;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:100%;line-height:1.15}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}button::-moz-focus-inner{border-style:none;padding:0}[type=button]::-moz-focus-inner{border-style:none;padding:0}[type=reset]::-moz-focus-inner{border-style:none;padding:0}[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:1px dotted buttontext}[type=button]:-moz-focusring{outline:1px dotted buttontext}[type=reset]:-moz-focusring{outline:1px dotted buttontext}[type=submit]:-moz-focusring{outline:1px dotted buttontext}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;white-space:normal;max-width:100%;padding:0;display:table}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button{height:auto}[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}details{display:block}summary{display:list-item}[hidden],template{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}body,html{height:100%}body{background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);min-height:100%;font-family:PingFang SC,Sitka Text,Noto Sans SC,Microsoft YaHei,sans-serif;font-size:1em;line-height:2;transition:padding .2s ease-in-out;position:relative}h1,h2,h3,h4,h5,h6{margin:30px 0 15px;font-family:PingFang SC,Sitka Text,Noto Sans SC,Microsoft YaHei,sans-serif;font-weight:700;line-height:1.5}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}a{color:var(--link-color);cursor:pointer;overflow-wrap:break-word;border-bottom:1px solid #999;outline:0;text-decoration:none}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}embed,iframe,img,video{max-width:100%;margin-left:auto;margin-right:auto;display:block}hr{background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,#0000 4px 8px);border:0;height:3px;margin:40px 0}blockquote{color:var(--blockquote-color);border-left:4px solid #ddd;margin:0;padding:0 15px}blockquote cite:before{content:"-";padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}.table-container{overflow:auto}table{border-collapse:collapse;border-spacing:0;width:100%;margin:0 0 20px;font-size:.875em}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,td,th{padding:8px}td,th{border:1px solid #ddd;border-bottom-width:3px}th{padding-bottom:10px;font-weight:700}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);color:var(--btn-default-color);border-radius:2px;padding:0 20px;font-size:.875em;line-height:2;transition:background-color .2s ease-in-out;display:inline-block}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.28571em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;width:100%;height:2px;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;display:block;position:relative;top:0;left:0}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{width:50%;top:2px;left:50%;transform:rotate(45deg)}.toggle.toggle-arrow :last-child{width:50%;top:-2px;left:50%;transform:rotate(-45deg)}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}pre code.hljs{padding:1em;display:block;overflow-x:auto}code.hljs{padding:3px 5px}.hljs{color:#24292e;background:#fff}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#d73a49}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#6f42c1}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#005cc5}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#032f62}.hljs-built_in,.hljs-symbol{color:#e36209}.hljs-code,.hljs-comment,.hljs-formula{color:#6a737d}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#22863a}.hljs-subst{color:#24292e}.hljs-section{color:#005cc5;font-weight:700}.hljs-bullet{color:#735c0f}.hljs-emphasis{color:#24292e;font-style:italic}.hljs-strong{color:#24292e;font-weight:700}.hljs-addition{color:#22863a;background-color:#f0fff4}.hljs-deletion{color:#b31d28;background-color:#ffeef0}@media (prefers-color-scheme:dark){pre code.hljs{padding:1em;display:block;overflow-x:auto}code.hljs{padding:3px 5px}.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}}.code-container:hover .copy-btn,.highlight:hover .copy-btn{opacity:1}.code-container{position:relative}.copy-btn{color:#333;cursor:pointer;opacity:0;background:#fff;border:0;padding:2px 6px;font-size:.8125em;line-height:1.6;transition:opacity .2s ease-in-out;position:absolute;top:0;right:0}code,figure.highlight,kbd,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{margin:0 auto 20px;line-height:1.6}figure.highlight figcaption,pre .caption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);padding:.5em;font-size:.875em;line-height:1.2;display:flow-root}figure.highlight figcaption a,pre .caption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover{border-bottom-color:var(--highlight-foreground)}code,pre{font-family:Roboto Mono,consolas,Menlo,monospace,PingFang SC,Microsoft YaHei}code{overflow-wrap:break-word;border-radius:3px;padding:2px 4px;font-size:.875em}kbd{white-space:nowrap;border:2px solid #ccc;border-radius:.2em;padding:.1em .3em;font-family:inherit;box-shadow:.1em .1em .2em #0000001a}figure.highlight{position:relative;overflow:auto}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;width:auto;margin:0}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);text-align:right;padding-left:10px;padding-right:10px}figure.highlight .code pre{width:100%;padding-left:10px}figure.highlight .marked{background:#0000004d}pre .caption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre{padding:10px;overflow:auto}pre code{text-shadow:none;background:0 0;padding:0}.blockquote-center{text-align:center;border-left:0;margin:40px 0;padding:0;position:relative}.blockquote-center:after,.blockquote-center:before{opacity:.6;width:100%;line-height:1;position:absolute;left:0}.blockquote-center:before{text-align:left;content:"";border-top:1px solid #ccc;font-family:"Font Awesome 6 Free";font-weight:900;top:-20px}.blockquote-center:after{text-align:right;content:"";border-bottom:1px solid #ccc;font-family:"Font Awesome 6 Free";font-weight:900;bottom:-20px}.blockquote-center div,.blockquote-center p{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{gap:3px;margin-bottom:3px;display:flex}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{object-fit:cover;width:100%;height:100%;margin:0}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{grid-gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;margin-bottom:20px;padding:1rem;display:grid}.post-body .link-grid .link-grid-container{border:solid #ddd;min-width:0;min-height:5rem;padding:.5rem;transition:background .3s;position:relative;box-shadow:1rem 1rem .5rem #00000080}.post-body .link-grid .link-grid-container:hover{background:var(--card-bg-color);animation:.5s next-shake}.post-body .link-grid .link-grid-container:active{transform:translate(.2rem,.2rem);box-shadow:.5rem .5rem .25rem #00000080}.post-body .link-grid .link-grid-container .link-grid-image{box-sizing:border-box;border:1px solid #ddd;border-radius:50%;width:5rem;height:5rem;padding:3px;position:absolute}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{opacity:.7;font-size:.8em;line-height:1.3rem}.post-body .link-grid .link-grid-container a{border:0;width:100%;height:100%;position:absolute;top:0;left:0}@keyframes next-shake{0%{transform:translate(1pt,1pt) rotate(0)}10%{transform:translate(-1pt,-2pt) rotate(-1deg)}20%{transform:translate(-3pt) rotate(1deg)}30%{transform:translate(3pt,2pt) rotate(0)}40%{transform:translate(1pt,-1pt) rotate(1deg)}50%{transform:translate(-1pt,2pt) rotate(-1deg)}60%{transform:translate(-3pt,1pt) rotate(0)}70%{transform:translate(3pt,1pt) rotate(-1deg)}80%{transform:translate(-1pt,-1pt) rotate(1deg)}90%{transform:translate(1pt,2pt) rotate(0)}to{transform:translate(1pt,-2pt) rotate(-1deg)}}.post-body .note{border:1px solid #eee;border-left-width:5px;border-radius:3px;margin-bottom:20px;padding:1em;position:relative}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);z-index:5;flex-wrap:wrap;justify-content:center;margin:0;padding:0;display:flex;position:sticky;top:0}@media (max-width:413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{margin-bottom:5px;display:block}}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-top-width:3px;border-bottom-color:#ddd;border-radius:0;flex-grow:1;list-style-type:none}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-left-width:3px;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;text-align:center;padding:.25em .75em;line-height:1.8;transition:all .2s ease-out;display:block}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.28571em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd #0000}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-top-color:#0000;border-radius:0}@media (max-width:413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-top-color:#ddd;border-radius:0}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:-1px 10px 0;padding:0 10px;display:inline-block}@media (max-width:767px){.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}}.pagination .page-number.current{color:var(--content-bg-color);background:#ccc;border-color:#ccc}.pagination{text-align:center;border-top:1px solid #eee;margin:120px 0 0}.pagination .next,.pagination .page-number,.pagination .prev{border-top:1px solid #eee;border-bottom:0;transition:border-color .2s ease-in-out}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:var(--link-hover-color)}@media (max-width:767px){.pagination{border-top:0}.pagination .next,.pagination .page-number,.pagination .prev{border-top:0;border-bottom:1px solid #eee}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:var(--link-hover-color)}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{flex-wrap:wrap;justify-content:center;margin:1em 0;display:flex}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:0}@media (max-width:991px){.headband{display:none}}.site-brand-container{flex-shrink:0;padding:0 10px;display:flex}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{text-align:center;flex-grow:1}@media (max-width:767px){.site-meta{text-align:center}}.custom-logo-image{margin-top:20px}@media (max-width:991px){.custom-logo-image{display:none}}.brand{color:var(--brand-color);border-bottom:0;padding:0;display:inline-block}.brand:hover{color:var(--brand-hover-color)}.site-title{margin:0;font-family:PingFang SC,Sitka Text,Noto Sans SC,Microsoft YaHei,sans-serif;font-size:1.5em;font-weight:400;line-height:1.5}.site-subtitle{color:#ddd;margin:10px 10px 0;font-size:.8125em}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-right,.site-nav-toggle{display:none}@media (max-width:767px){.site-nav-right,.site-nav-toggle{flex-direction:column;justify-content:center;display:flex}}.site-nav-right .toggle,.site-nav-toggle .toggle{color:var(--text-color);width:22px;padding:10px}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (max-width:767px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{text-align:center;margin:0;padding:1em 0}.menu-item{margin:0 10px;list-style:none;display:inline-block}@media (max-width:767px){.menu-item{margin-top:10px;display:block}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;font-size:.8125em;transition:border-color .2s ease-in-out;display:block}.menu-item a.menu-item-active,.menu-item a:hover{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-weight:700;line-height:1}.use-motion .menu-item{visibility:hidden}@media (max-width:991px){.sidebar{left:-320px}.sidebar-active .sidebar{left:0}.sidebar{z-index:20;background:#222;width:320px;max-height:100vh;transition:left .2s ease-out,right .2s ease-out;position:fixed;top:0;bottom:0;overflow-y:auto;box-shadow:inset 0 2px 6px #000}.sidebar a{color:#999;border-bottom-color:#555}.sidebar a:hover{color:#eee;border-bottom-color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{vertical-align:middle;border-bottom-color:#555;margin-bottom:10px;margin-right:10px;transition:all .2s ease-in-out;display:inline-block}.links-of-author a:before{content:" ";background:#5d7928;border-radius:50%;width:4px;height:4px;margin-right:3px;display:inline-block;transform:translateY(-2px)}.links-of-blogroll-item{padding:0 5px}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{opacity:0;visibility:hidden;z-index:10;background:#000;width:100%;height:100%;transition:visibility .4s,opacity .4s;position:fixed;top:0;left:0}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;text-align:center;flex-direction:column;justify-content:center;padding:18px 10px;display:flex}.sidebar-toggle{cursor:pointer;opacity:.6;z-index:30;background:#222;width:16px;height:16px;padding:5px;position:fixed;bottom:61px;left:30px}@media (max-width:991px){.sidebar-toggle{left:20px}}.sidebar-toggle:hover{opacity:.8}@media (max-width:991px){.sidebar-toggle{opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{width:50%;top:2px;left:50%;transform:rotate(45deg)}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{width:50%;top:-2px;left:50%;transform:rotate(-45deg)}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.sidebar-nav{pointer-events:none;visibility:hidden;height:0;margin:0;padding-left:0;font-size:.875em;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}.sidebar-nav-active .sidebar-nav{pointer-events:unset;height:calc(2em + 1px);visibility:unset}.sidebar-nav li{color:var(--text-color);cursor:pointer;border-bottom:1px solid #0000;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out;display:inline-block}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-overview-active .sidebar-nav-overview,.sidebar-toc-active .sidebar-nav-toc{color:#fc6423;border-bottom-color:#fc6423;transition-delay:.2s}.sidebar-overview-active .sidebar-nav-overview:hover,.sidebar-toc-active .sidebar-nav-toc:hover{color:#fc6423}.sidebar-panel-container{flex:1;align-items:start;padding-top:0;transition:padding-top .2s ease-in-out;display:grid;overflow:hidden auto}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{opacity:0;pointer-events:none;visibility:hidden;grid-area:1/1;height:0;transition:opacity .2s ease-in-out,transform .2s ease-in-out,visibility .2s ease-in-out;animation:.2s ease-in-out deactivate-sidebar-panel;overflow:hidden;transform:translateY(0)}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{opacity:1;pointer-events:unset;height:auto;visibility:unset;transition-delay:.2s,.2s,0s;animation-name:activate-sidebar-panel;transform:translateY(0)}.sidebar-panel.site-overview-wrap{flex-direction:column;justify-content:flex-start;gap:10px;display:flex}@keyframes deactivate-sidebar-panel{0%{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{0%{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.post-toc{font-size:.875em}.post-toc ol{text-align:left;margin:0;padding:0 2px 0 10px;list-style:none}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:all .2s ease-in-out}.post-toc .nav-item{text-overflow:ellipsis;white-space:nowrap;line-height:1.8;overflow:hidden}.post-toc .nav .active>a{color:#fc6423;border-bottom-color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-author-image{border:1px solid #eee;border-radius:50%;max-width:120px;padding:2px;transition:transform 1s ease-out}.site-author-image:hover{transform:rotate(360deg)}.site-author-name{color:var(--text-color);margin:0;font-weight:600}.site-description{color:#999;margin-top:0;font-size:.8125em}.site-state{flex-wrap:wrap;justify-content:center;line-height:1.4;display:flex}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{font-size:1em;font-weight:600;display:block}.site-state-item-name{color:#999;font-size:.8125em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{color:#fc6423;cursor:pointer;background:0 0;border:1px solid #fc6423;border-radius:4px;padding:0 15px;line-height:2}.sidebar .sidebar-button button:hover{color:#fff;background:#fc6423}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-author a{font-size:.8125em}.links-of-author i[class^=fa]{margin-right:2px}.cc-license .cc-opacity{opacity:.7;border-bottom:0}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{flex-flow:column wrap;justify-content:center;gap:5px;margin:5px 0 0;padding:0;list-style:none;display:flex}.links-of-blogroll-item{max-width:100%}.links-of-blogroll-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;max-width:100%;display:inline-block;overflow:hidden}.sidebar-post-related{padding:18px 0 0;font-size:.8125em}.popular-posts{text-align:left;margin:0;padding:1em 0}.popular-posts .popular-posts-item{display:block}.popular-posts .popular-posts-item .popular-posts-link{border-bottom:0;padding:5px 20px;transition:background .2s ease-in-out;display:block}.popular-posts .popular-posts-item .popular-posts-link:hover{background:var(--menu-item-bg-color)}.popular-posts .popular-posts-item .popular-posts-time{color:#999}.footer{color:#999;padding:20px 0;font-size:.875em;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{position:absolute;bottom:0;left:0;right:0}.footer-inner{box-sizing:border-box;text-align:center;flex-direction:column;justify-content:center;width:calc(100% - 20px);margin:0 auto;display:flex}@media (max-width:767px){.footer-inner{width:auto}}@media (min-width:1200px){.footer-inner{width:1160px}}@media (min-width:1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{font-size:1.125em;display:inline-block;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{opacity:0;width:100%;height:100%;position:absolute;top:0;left:0}.with-love{color:gray;margin:0 5px;display:inline-block}.busuanzi-count #busuanzi_container_site_pv,.busuanzi-count #busuanzi_container_site_uv{display:none}@keyframes icon-animate{0%,to{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,60%,80%{transform:scale(1.1)}50%,70%{transform:scale(1.1)}}.back-to-top{color:#fff;cursor:pointer;opacity:.6;z-index:30;background:#222;align-items:center;height:26px;font-size:12px;transition:bottom .2s ease-in-out;display:flex;position:fixed;bottom:-100px;left:30px}.back-to-top span{margin-right:8px;display:none}.back-to-top .fa{text-align:center;width:26px}@media (max-width:991px){.back-to-top{left:20px}}.back-to-top:hover{opacity:.8}@media (max-width:991px){.back-to-top{opacity:.8}}.back-to-top:hover{color:#fc6423}.back-to-top.back-to-top-on{bottom:30px}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{text-align:center;margin-top:40px}.use-motion .collection-header,.use-motion .comments,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (max-width:767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title:before{content:" ";background:#999;border:1px solid #fff;border-radius:50%;width:10px;height:10px;margin-top:-4px;margin-left:-6px;position:absolute;top:50%}.posts-collapse .post-content .collection-year{margin:60px 0;font-size:1.4em;font-weight:700;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-size:.75em;font-weight:700;line-height:1}.posts-collapse .post-content .collection-year:before{content:" ";background:#bbb;border-radius:50%;width:8px;height:8px;margin-top:-4px;margin-left:-4px;position:absolute;top:50%}.posts-collapse .post-content .collection-header{margin-left:20px;display:block}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;transition:border .2s ease-in-out;position:relative}.posts-collapse .post-content .post-header:before{content:" ";background:#bbb;border:1px solid #fff;border-radius:50%;width:6px;height:6px;transition:background .2s ease-in-out;position:absolute;top:.75em;left:-6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover:before{background:#222}.posts-collapse .post-content .post-meta-container{margin-right:10px;font-size:.75em;display:inline}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{color:var(--link-color);border-bottom:0}.posts-collapse .post-content .post-title .fa{margin-left:5px;font-size:.875em}.posts-collapse .post-content:before{content:" ";background:#f5f5f5;width:4px;height:100%;margin-left:-2px;position:absolute;top:1.25em}.post-body{overflow-wrap:break-word;font-family:PingFang SC,Sitka Text,Noto Sans SC,Microsoft YaHei,sans-serif}@media (min-width:1200px){.post-body{font-size:1.125em}}@media (min-width:992px){.post-body{text-align:justify}}@media (max-width:991px){.post-body{text-align:justify}}.post-body h1 .header-anchor,.post-body h1 .headerlink,.post-body h2 .header-anchor,.post-body h2 .headerlink,.post-body h3 .header-anchor,.post-body h3 .headerlink,.post-body h4 .header-anchor,.post-body h4 .headerlink,.post-body h5 .header-anchor,.post-body h5 .headerlink,.post-body h6 .header-anchor,.post-body h6 .headerlink{color:inherit;float:right;opacity:0;border-bottom-style:none;margin-left:10px;font-size:.875em}.post-body h1 .header-anchor:before,.post-body h1 .headerlink:before,.post-body h2 .header-anchor:before,.post-body h2 .headerlink:before,.post-body h3 .header-anchor:before,.post-body h3 .headerlink:before,.post-body h4 .header-anchor:before,.post-body h4 .headerlink:before,.post-body h5 .header-anchor:before,.post-body h5 .headerlink:before,.post-body h6 .header-anchor:before,.post-body h6 .headerlink:before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body h1:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .header-anchor,.post-body h2:hover .headerlink,.post-body h3:hover .header-anchor,.post-body h3:hover .headerlink,.post-body h4:hover .header-anchor,.post-body h4:hover .headerlink,.post-body h5:hover .header-anchor,.post-body h5:hover .headerlink,.post-body h6:hover .header-anchor,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .header-anchor:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .header-anchor:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .header-anchor:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .header-anchor:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .header-anchor:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{margin-left:4px;font-size:.875em}.post-body figure:not(.highlight) figcaption{color:#999;text-align:center;margin:-15px auto 15px;font-size:.875em;font-weight:700;line-height:1}.post-body embed,.post-body iframe,.post-body img,.post-body video{margin-bottom:20px}.post-body .video-container{width:100%;height:0;margin-bottom:20px;padding-top:75%;position:relative;overflow:hidden}.post-body .video-container embed,.post-body .video-container iframe,.post-body .video-container object{width:100%;height:100%;margin:0;position:absolute;top:0;left:0}.post-gallery{min-height:200px;display:flex}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{object-fit:cover;opacity:1;width:100%;height:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{text-align:center;margin-bottom:60px;font-size:1.125em}.posts-expand .post-title{margin:initial;overflow-wrap:break-word;font-size:1.4em;font-weight:400}.posts-expand .post-title-link{color:var(--link-color);border-bottom:0;display:inline-block;position:relative}.posts-expand .post-title-link:before{background:var(--link-color);content:"";width:100%;height:2px;transition:transform .2s ease-in-out;position:absolute;bottom:0;left:0;transform:scaleX(0)}.posts-expand .post-title-link:hover:before{transform:scaleX(1)}.posts-expand .post-title-link .fa{margin-left:5px;font-size:.875em}.post-sticky-flag{margin-right:8px;display:inline-block;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;margin-top:3px;font-family:PingFang SC,Sitka Text,Noto Sans SC,Microsoft YaHei,sans-serif;font-size:.75em}.posts-expand .post-meta-container .post-description{margin-top:2px;font-size:.875em}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{flex-wrap:wrap;justify-content:center;display:flex}:not(.post-meta-break)+.post-meta-item:before{content:"|";margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (max-width:991px){.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}#busuanzi_container_page_pv{display:none}.post-nav{border-top:1px solid #eee;justify-content:space-between;gap:30px;margin-top:1em;padding:10px 5px 0;display:flex}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;font-size:.875em;line-height:1.6;display:block}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{flex-direction:column;justify-content:center;display:flex}.post-eof{background:#ccc;width:8%;height:1px;margin:80px auto 60px}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0;padding:.5em 1em;list-style:none;position:relative;overflow:hidden}.post-copyright ul:after{content:"";opacity:.1;font-family:"Font Awesome 6 Brands";font-size:200px;position:absolute;top:-150px;right:-50px}.post-tags{text-align:center;margin-top:40px}.post-tags a{font-size:.8125em;display:inline-block}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;flex-wrap:wrap;justify-content:center;margin-top:1em;padding-top:1em;font-size:.875em;display:flex}.social-like a{border-bottom:none}.reward-container{text-align:center;margin:1em 0 0;padding:1em 0}.reward-container button{color:#fc6423;cursor:pointer;vertical-align:text-top;background:0 0;border:2px solid #fc6423;border-radius:2px;outline:0;padding:0 15px;line-height:2}.reward-container button:hover{color:#fff;background:#fc6423}.post-reward{padding-top:20px;display:none}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{width:180px;max-width:100%;margin:.8em 2em 0;display:inline-block}@keyframes next-roll{0%{transform:rotate(30deg)}to{transform:rotate(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{margin:0;padding:0;list-style:none}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-size:.75em;font-weight:700;line-height:1}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr:after{color:#fff;content:"NOW";background:#222;padding:0 5px;font-weight:700;display:inline-block}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{color:var(--event-title);border-bottom:0;margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary:before{background:var(--event-title);content:" ";border-radius:50%;width:12px;height:12px;margin-top:-6px;animation:1s ease-in-out infinite alternate dot-flash;position:absolute;top:50%;left:0}.event-list .event:nth-of-type(odd) .event-summary:before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);padding-left:12px;font-size:12px;font-weight:400;display:inline-block}.event-list .event .event-details{color:var(--event-foreground);padding:6px 0 6px 35px;line-height:18px;display:block}.event-list .event .event-details:before{color:var(--event-foreground);width:14px;margin-right:9px;font-family:"Font Awesome 6 Free";font-weight:900;display:inline-block}.event-list .event .event-details.event-location:before{content:""}.event-list .event .event-details.event-duration:before{content:""}.event-list .event .event-details.event-description:before{content:""}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{text-align:center;margin:1em 0;padding:0 2em;font-size:.75em;list-style:none}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child):before{content:"/ ";padding:.5em;font-weight:400}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{margin:10px;display:inline-block}.tag-cloud-0{color:#aaa;border-bottom-color:#aaa}.tag-cloud-1{color:#9a9a9a;border-bottom-color:#9a9a9a}.tag-cloud-2{color:#8b8b8b;border-bottom-color:#8b8b8b}.tag-cloud-3{color:#7c7c7c;border-bottom-color:#7c7c7c}.tag-cloud-4{color:#6c6c6c;border-bottom-color:#6c6c6c}.tag-cloud-5{color:#5d5d5d;border-bottom-color:#5d5d5d}.tag-cloud-6{color:#4e4e4e;border-bottom-color:#4e4e4e}.tag-cloud-7{color:#3e3e3e;border-bottom-color:#3e3e3e}.tag-cloud-8{color:#2f2f2f;border-bottom-color:#2f2f2f}.tag-cloud-9{color:#202020;border-bottom-color:#202020}.tag-cloud-10{color:#111;border-bottom-color:#111}@media (prefers-color-scheme:dark){.tag-cloud-0{color:#555;border-bottom-color:#555}.tag-cloud-1{color:#646464;border-bottom-color:#646464}.tag-cloud-2{color:#737373;border-bottom-color:#737373}.tag-cloud-3{color:#828282;border-bottom-color:#828282}.tag-cloud-4{color:#929292;border-bottom-color:#929292}.tag-cloud-5{color:#a1a1a1;border-bottom-color:#a1a1a1}.tag-cloud-6{color:#b0b0b0;border-bottom-color:#b0b0b0}.tag-cloud-7{color:silver;border-bottom-color:silver}.tag-cloud-8{color:#cfcfcf;border-bottom-color:#cfcfcf}.tag-cloud-9{color:#dedede;border-bottom-color:#dedede}.tag-cloud-10{color:#eee;border-bottom-color:#eee}}.utterances{max-width:unset}.search-active{overflow:hidden}.search-pop-overlay{visibility:hidden;z-index:40;background:0 0;width:100%;height:100%;transition:visibility .4s,background .4s;display:flex;position:fixed;top:0;left:0}.search-active .search-pop-overlay{visibility:visible;background:#0000004d}.search-popup{background:var(--card-bg-color);border-radius:5px;width:700px;height:80%;margin:auto;transition:transform .4s;transform:scale(0)}.search-active .search-popup{transform:scale(1)}@media (max-width:767px){.search-popup{border-radius:0;width:100%;height:100%}}.search-popup .popup-btn-close,.search-popup .search-icon{color:#999;padding:0 10px;font-size:18px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;padding:5px;display:flex}@media (prefers-color-scheme:dark){.search-popup .search-header{background:#666}}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{flex-direction:column;height:calc(100% - 55px);padding:5px 25px;display:flex;overflow:auto}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{color:#ff2a2a;background:0 0;border-bottom:1px dashed #ff2a2a;font-weight:700}.search-stats{justify-content:space-between;align-items:center;display:flex}.search-stats img{height:1em;margin:0}.pagination.algolia-pagination{visibility:visible;margin-top:auto;padding:40px 0}.use-motion .animated{visibility:inherit;animation-fill-mode:none}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:10px;box-shadow:0 2px 4px #0000000d}@media (max-width:991px){header.header{border-radius:initial}}.main{justify-content:space-between;align-items:stretch;width:calc(100% - 20px);margin:0 auto;display:flex}@media (max-width:767px){.main{width:auto}}@media (min-width:1200px){.main{width:1160px}}@media (min-width:1600px){.main{width:73%}}@media (max-width:991px){.main{width:auto;display:block}}.main-inner{box-sizing:border-box;border-radius:10px;width:calc(100% - 260px)}@media (max-width:991px){.main-inner{border-radius:initial;width:100%}}.footer-inner{padding-left:260px}@media (max-width:991px){.footer-inner{width:auto;padding-left:0;padding-right:0}}.column{width:240px}@media (max-width:991px){.column{width:auto}}.site-brand-container{background:var(--theme-color)}@media (max-width:991px){.site-nav-on .site-brand-container{box-shadow:0 0 16px #00000080}}.site-meta{padding:20px 0}@media (min-width:768px) and (max-width:991px){.site-nav-right,.site-nav-toggle{flex-direction:column;justify-content:center;display:flex}}.site-nav-right .toggle,.site-nav-toggle .toggle{color:#fff}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:#fff}@media (min-width:768px) and (max-width:991px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{margin:0;display:block}.menu .menu-item a{align-items:center;padding:5px 20px;transition-property:background-color;display:flex;position:relative}.menu .menu-item a .badge{margin-left:auto}@media (max-width:991px){.menu .menu-item.menu-item-search{display:none}}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{padding:initial;background:0 0;margin:5px 10px}.sub-menu .menu-item a:hover{color:#fc6423;background:0 0}.sub-menu .menu-item-active{color:#fc6423;border-bottom-color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (min-width:992px){.sidebar{position:sticky;top:20px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);box-sizing:border-box;color:var(--text-color);border-radius:10px;max-height:calc(100vh - 40px);margin-top:20px;box-shadow:0 2px 4px #0000000d}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-top:1px dotted #ccc;border-bottom:1px dotted #ccc}.sidebar .sidebar-button button{color:#fc6423;border:0;width:100%;display:block}.sidebar .sidebar-button button:hover{color:#e34603;background:0 0;border:0}.links-of-author{flex-wrap:wrap;justify-content:center;display:flex}.links-of-author-item{width:50%;margin:5px 0 0}.links-of-author-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;border-bottom:0;border-radius:4px;max-width:100%;padding:0 5px;display:inline-block;overflow:hidden}.links-of-author-item a:hover{background:var(--body-bg-color)}.links-of-blogroll-item a{padding:0 5px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .post-block,.main-inner .sub-menu,.main-inner .tabs-comment,.main-inner>.comments{background:var(--content-bg-color);border-radius:10px;box-shadow:0 2px 4px #0000000d}.main-inner .post-block:not(:first-child):not(:first-child){border-radius:10px;margin-top:20px;box-shadow:0 2px 4px #0000000d}@media (min-width:768px) and (max-width:991px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:10px}}@media (max-width:767px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:8px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{border-radius:10px;margin-top:20px;box-shadow:0 2px 4px #0000000d}@media (min-width:768px) and (max-width:991px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:10px}}@media (max-width:767px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:8px}}.comments,.post-block{padding:40px}.post-eof{display:none}.pagination{border-top:initial;padding:10px 0}.post-body h1,.post-body h2{border-bottom:1px solid #eee}.post-body h3{border-bottom:1px dotted #eee}@media (min-width:768px) and (max-width:991px){.main-inner{padding:10px}.posts-expand .post-button{margin-top:20px}.post-block{padding:20px}.comments{padding:10px 20px}}@media (max-width:767px){.main-inner{padding:8px}.posts-expand .post-button{margin:20px 0}.post-block{padding:20px}.comments{padding:10px 20px}}.posts-expand{opacity:.95}.sidebar{opacity:.9}.header-inner{background:#ffffffe6}.popup{opacity:.9}.header-inner{overflow:hidden}@media (min-width:991px){.main{margin-top:40px}}.main-inner .post-block:not(:first-child):not(:first-child),.sidebar-inner{margin-top:20px}figure.highlight{border-radius:4px;overflow:hidden}figure.highlight .gutter pre{border-right:1px solid #c5c5c5}.site-brand-container{border-radius:10px 10px 3px 3px}.posts-expand .post-title{font-weight:700}.site-subtitle{font-size:.7em;font-style:italic}.site-author-name{font-variation-settings:"opsz" 24.6303,"wght" 700;font-family:Sitka Text,Noto Sans SC,PingFang SC,Microsoft YaHei,sans-serif;font-weight:700}.post-body h1 .header-anchor-1,.post-body h2 .header-anchor-1,.post-body h3 .header-anchor-1,.post-body h4 .header-anchor-1,.post-body h5 .header-anchor-1,.post-body h6 .header-anchor-1{color:inherit;float:left;-webkit-margin-start:calc(-.875em + .15em);opacity:0;border-bottom-style:none;margin-inline-start:-.725em;font-size:.875em;transition:opacity .2s}.post-body h1:hover .header-anchor-1,.post-body h2:hover .header-anchor-1,.post-body h3:hover .header-anchor-1,.post-body h4:hover .header-anchor-1,.post-body h5:hover .header-anchor-1,.post-body h6:hover .header-anchor-1{opacity:.5}.post-body h1:hover .header-anchor-1:hover,.post-body h2:hover .header-anchor-1:hover,.post-body h3:hover .header-anchor-1:hover,.post-body h4:hover .header-anchor-1:hover,.post-body h5:hover .header-anchor-1:hover,.post-body h6:hover .header-anchor-1:hover{opacity:1}.info,.tip{color:#185d8a;background-color:#bae2fc;border-left:4px solid #3498db;padding-left:10px}.success{color:#286f4f;background-color:#caffe7;border-left:4px solid #42b983;padding-left:10px}.warning{color:#8b7300;background-color:#fff7d0;border-left:4px solid #e7c000;padding-left:10px}.danger{color:#7a0000;background-color:#ffe6e6;border-left:4px solid #c00;padding-left:10px}.posts-expand .post-header{margin-bottom:30px}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/orange/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script><script class="next-config" data-name="main" type="application/json">{"hostname":"frezcirno.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.22.0","exturl":true,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"2FQMQ0WT67","apiKey":"756d1525441f92ed29f8f7f9be42f683","indexName":"blog","hits":{"per_page":10}}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/config.min.js" defer></script><meta name="description" content="本文深入解读Amazon的Dynamo系统, 这是一种高可用、可扩展的键值存储方案. Dynamo旨在应对大规模电子商务平台在运行过程中面临的性能和可靠性挑战, 采用去中心化架构, 确保系统在出现故障时的持续可用性. 通过一致性哈希等技术, Dynamo实现了数据的高效分片与复制, 支持主键访问以满足多种应用需求. 本文还探讨了Dynamo的设计决策与实施细节, 为理解现代分布式存储系统提供了重要"><meta property="og:type" content="blog"><meta property="og:title" content="[SOSP'07] Dynamo: Amazon’s Highly Available Key-value Store 论文阅读"><meta property="og:url" content="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/index.html"><meta property="og:site_name" content="tantan的博客"><meta property="og:description" content="本文深入解读Amazon的Dynamo系统, 这是一种高可用、可扩展的键值存储方案. Dynamo旨在应对大规模电子商务平台在运行过程中面临的性能和可靠性挑战, 采用去中心化架构, 确保系统在出现故障时的持续可用性. 通过一致性哈希等技术, Dynamo实现了数据的高效分片与复制, 支持主键访问以满足多种应用需求. 本文还探讨了Dynamo的设计决策与实施细节, 为理解现代分布式存储系统提供了重要"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/image2.png"><meta property="og:image" content="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/image.png"><meta property="article:published_time" content="2025-04-13T07:24:09.000Z"><meta property="article:modified_time" content="2025-11-09T05:44:06.646Z"><meta property="article:author" content="frezcirno"><meta property="article:tag" content="数据库"><meta property="article:tag" content="分布式系统"><meta property="article:tag" content="K-V 存储"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/image2.png"><link rel="canonical" href="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/","path":"2025/04/13/dynamo-amazons-highly-available-key-value-store/","title":"[SOSP'07] Dynamo: Amazon’s Highly Available Key-value Store 论文阅读"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>[SOSP'07] Dynamo: Amazon’s Highly Available Key-value Store 论文阅读 | tantan的博客</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9HV7FT1HW"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-Y9HV7FT1HW","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/analytics/google-analytics.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/utils.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/sidebar.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/next-boot.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.24.0/algoliasearch-lite.umd.js" integrity="sha256-b2n6oSgG4C1stMT/yc/ChGszs9EY/Mhs6oltEjQbFCQ=" crossorigin="anonymous" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/search/algolia-search.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/pace.min.js" defer></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous"><script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/math/katex.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous" defer></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/quicklink.min.js" defer></script><script defer src="/assets/drawFlower.js"></script><style>@font-face{font-family:'Libertinus Serif';font-style:normal;font-weight:400;src:local('Libertinus Serif'),local('Libertinus-Serif'),url(https://frezcirno.github.io/static/Libertinus-7.040/static/WOFF2/LibertinusSerif-Regular.woff2) format('woff2');font-display:swap}@font-face{font-family:'Libertinus Sans';font-style:normal;font-weight:400;src:local('Libertinus Sans'),local('Libertinus-Sans'),url(https://frezcirno.github.io/static/Libertinus-7.040/static/WOFF2/LibertinusSans-Regular.woff2) format('woff2');font-display:swap}@font-face{font-family:'Libertinus Math';font-style:normal;font-weight:400;src:local('Libertinus Math'),local('Libertinus-Math'),url(https://frezcirno.github.io/static/Libertinus-7.040/static/WOFF2/LibertinusMath-Regular.woff2) format('woff2');font-display:swap}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v23/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW4.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Sitka Text';font-style:normal;font-display:swap;src:local('Sitka Text'),local('Sitka-Text'),url(https://frezcirno.github.io/static/Sitka/SitkaVF.woff) format('woff'),url(https://frezcirno.github.io/static/Sitka/SitkaVF.woff2) format('woff2')}@font-face{font-family:'Sitka Text';font-style:italic;font-display:swap;src:local('Sitka Text'),local('Sitka-Text'),url(https://frezcirno.github.io/static/Sitka/SitkaVF-Italic.woff) format('woff'),url(https://frezcirno.github.io/static/Sitka/SitkaVF-Italic.woff2) format('woff2')}</style><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">tantan的博客</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Notes, ideas, and observations</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">113</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">31</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">174</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fab fa-algolia fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%BC%95%E8%A8%80"><span class="nav-text">1. 引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%83%8C%E6%99%AF"><span class="nav-text">2. 背景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%B3%BB%E7%BB%9F%E5%81%87%E8%AE%BE%E5%92%8C%E9%9C%80%E6%B1%82"><span class="nav-text">2.1 系统假设和需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-sla"><span class="nav-text">2.2 SLA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%AE%BE%E8%AE%A1%E8%80%83%E8%99%91%E5%9B%A0%E7%B4%A0"><span class="nav-text">2.3 设计考虑因素</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C"><span class="nav-text">3. 相关工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-p2p-%E7%B3%BB%E7%BB%9F"><span class="nav-text">3.1 P2P 系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">3.2 分布式文件系统和数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E8%AE%A8%E8%AE%BA"><span class="nav-text">3.3 讨论</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="nav-text">4. 系统架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%8E%A5%E5%8F%A3"><span class="nav-text">4.1 接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87"><span class="nav-text">4.2 数据分片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6"><span class="nav-text">4.3 数据复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E5%A4%9A%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="nav-text">4.4 多版本控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E6%89%A7%E8%A1%8C-get-%E5%92%8C-put-%E6%93%8D%E4%BD%9C-%E6%97%A0%E6%95%85%E9%9A%9C"><span class="nav-text">4.5 执行 get 和 put 操作 (无故障)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-%E5%A4%84%E7%90%86%E4%B8%B4%E6%97%B6%E6%95%85%E9%9A%9C-%E6%8F%90%E7%A4%BA%E5%BC%8F%E7%A7%BB%E4%BA%A4"><span class="nav-text">4.6 处理临时故障: 提示式移交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-%E5%A4%84%E7%90%86%E6%B0%B8%E4%B9%85%E6%80%A7%E6%95%85%E9%9A%9C-%E5%89%AF%E6%9C%AC%E5%90%8C%E6%AD%A5"><span class="nav-text">4.7 处理永久性故障: 副本同步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-%E6%88%90%E5%91%98%E5%92%8C%E6%95%85%E9%9A%9C%E6%A3%80%E6%B5%8B"><span class="nav-text">4.8 成员和故障检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E8%8A%82%E7%82%B9"><span class="nav-text">4.9 添加/删除存储节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%AE%9E%E7%8E%B0"><span class="nav-text">5. 实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E7%BB%8F%E9%AA%8C%E5%92%8C%E6%95%99%E8%AE%AD"><span class="nav-text">6. 经验和教训</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E5%B9%B3%E8%A1%A1%E6%80%A7%E8%83%BD%E5%92%8C%E6%8C%81%E4%B9%85%E6%80%A7"><span class="nav-text">6.1 平衡性能和持久性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E7%A1%AE%E4%BF%9D%E5%9D%87%E5%8C%80%E8%B4%9F%E8%BD%BD%E5%88%86%E5%B8%83"><span class="nav-text">6.2 确保均匀负载分布</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E5%81%8F%E7%A6%BB%E7%9A%84%E7%89%88%E6%9C%AC-%E4%BD%95%E6%97%B6%E4%BB%A5%E5%8F%8A%E6%9C%89%E5%A4%9A%E5%B0%91"><span class="nav-text">6.3 偏离的版本: 何时以及有多少</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%B0%83%E8%BF%98%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8D%8F%E8%B0%83"><span class="nav-text">6.4 客户端协调还是服务器协调</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-%E5%B9%B3%E8%A1%A1%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%89%8D%E5%8F%B0%E4%BB%BB%E5%8A%A1"><span class="nav-text">6.5 平衡后台任务与前台任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-%E8%AE%A8%E8%AE%BA"><span class="nav-text">6.6 讨论</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E7%BB%93%E8%AE%BA"><span class="nav-text">7. 结论</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" width="120" height="120" itemprop="image" alt="frezcirno" src="https://frezcirno.github.io/static/avatar.webp"><p class="site-author-name" itemprop="name">frezcirno</p><div class="site-description" itemprop="description">编程爱好者</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">174</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">113</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZyZXpjaXJubw==" title="GitHub → https://github.com/frezcirno"><i class="fab fa-github fa-fw"></i> GitHub</span></span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOnRhbnppeHVhbi5tZUBnbWFpbC5jb20=" title="E-Mail → mailto:tanzixuan.me@gmail.com"><i class="fa fa-envelope fa-fw"></i> E-Mail</span></span></div><div class="cc-license animated" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://frezcirno.github.io/static/avatar.webp"><meta itemprop="name" content="frezcirno"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="tantan的博客"><meta itemprop="description" content="编程爱好者"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="[SOSP'07] Dynamo: Amazon’s Highly Available Key-value Store 论文阅读 | tantan的博客"><meta itemprop="description" content="本文深入解读Amazon的Dynamo系统, 这是一种高可用、可扩展的键值存储方案. Dynamo旨在应对大规模电子商务平台在运行过程中面临的性能和可靠性挑战, 采用去中心化架构, 确保系统在出现故障时的持续可用性. 通过一致性哈希等技术, Dynamo实现了数据的高效分片与复制, 支持主键访问以满足多种应用需求. 本文还探讨了Dynamo的设计决策与实施细节, 为理解现代分布式存储系统提供了重要参考."></span><header class="post-header"><h1 class="post-title" itemprop="name headline">[SOSP'07] Dynamo: Amazon’s Highly Available Key-value Store 论文阅读</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-04-13 15:24:09" itemprop="dateCreated datePublished" datetime="2025-04-13T15:24:09+08:00">2025-04-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/system/" itemprop="url" rel="index"><span itemprop="name">system</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/system/database-system/" itemprop="url" rel="index"><span itemprop="name">database-system</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-break"></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>20k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>1:13</span></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>发表于 SOSP 2007 2017 年获得 SOSP Hall of Fame Award NoSQL 领域的里程碑之作, 启发了后续众多系统的设计催生了 AWS DynamoDB 服务</p></blockquote><p>Dynamo 是 Amazon 在 2007 年发表的大规模分布式 K-V 存储系统. 作为电商领域的巨头, Amazon 较早面临巨大业务规模带来的技术挑战. Dynamo 的技术方案在当时的分布式系统中是非常前沿的, 其设计思想和实现细节对后来的 NoSQL 系统产生了深远的影响.</p><h2 id="1-引言"><a class="header-anchor-1" href="#1-引言">#</a>1. 引言</h2><p>Amazon 运行一个全球范围的电子商务平台, 在高峰时段为数百万客户提供服务, 使用世界各地多个数据中心的数千台服务器. 在这种环境下, Amazon 对性能、可靠性和效率有着严格的要求. 可靠性是最重要的要求之一, 因为即使是最细微的停机, 也会产生巨大的经济损失, 并影响客户信任. 此外, 为了支持平台的持续增长, 平台需要具备高度的可扩展性.</p><p>在运营 Amazon 平台的过程中, 我们学到的一个教训是, 一个系统的可靠性和可扩展性取决于应用状态的管理方式. Amazon 使用了一个<strong>高度去中心化</strong>、<strong>松耦合</strong>、<strong>面向服务</strong>的架构来管理数百个服务. 在这种环境下, 需要一种始终可用的数据存储技术. 例如, 即使发生磁盘故障、网络路由抖动或者甚至数据中心被龙卷风摧毁, 客户也应该能够查看并添加商品到他们的购物车中. 因此, 负责管理购物车的服务必须确保它总是可以写入和读取数据存储, 并且其数据需要再多个数据中心之间可用.</p><p>处理由数百万个组件组成的基础设施中的故障是我们的标准操作模式；在任意给定的时刻, 总有一些服务器和网络组件处于故障状态. 因此, 亚马逊的软件系统需要以这样的方式构建：将处理故障视为正常情况, 而不会影响可用性或性能.</p><blockquote><p>The major difference between a thing that might go wrong and a thing that cannot possibly go wrong is that when a thing that cannot possibly go wrong goes wrong it usually turns out to be impossible to get at or repair.</p><p>可能出错的事物 与 不可能出错的事物 之间的主要区别是, 当一个不可能出错的事物出错时, 通常不可能修复.</p><p>Douglas Adams, <em>Mostly Harmless</em>（1992）</p></blockquote><p>为了满足这些要求, Amazon 开发了一系列存储技术. 其中最著名的可能是 Amazon S3, AWS 对外也提供该服务. 本文介绍了 Dynamo – 另一个高可用且可扩展的分布式数据存储的设计和实现, 用于构建 Amazon 平台. Dynamo 用于管理<strong>对可靠性(reliability)要求非常高</strong>且需要严格控制<strong>可用性(availability)、一致性(consistency)、成本效益(cost-effectiveness)和性能之间权衡</strong>的服务状态. Amazon 平台上有很多不同的应用, 它们对存储的要求各不相同. 一组选定的应用需要一种足够灵活的存储技术, 以便应用开发人员可以根据这些权衡, 适当地配置他们的数据存储方式, 以最经济的方式实现高可用和有保证的性能.</p><p>Amazon 平台上有许多服务只需要对数据存储进行主键访问, 例如畅销书列表、购物车、客户偏好、会话管理、销售排名和产品目录的服务. 对于很多服务来说, 使用关系数据库的常见模式效率很低, 并且限制了规模和可用性. Dynamo 提供了一个简单的仅使用主键的接口来满足这些应用的需求.</p><p>Dynamo 综合运用了一系列众所周知的技术来实现可扩展性和可用性:</p><ul><li>数据通过<strong>一致性哈希</strong>进行分片和复制, 通过<strong>对象版本控制</strong>来保持一致性.</li><li>更新过程中, 副本之间的一致性通过类似 <strong>quorum</strong> 的方式和去中心化的<strong>副本同步协议</strong>来维护.</li><li>Dynamo 采用基于 <strong>Gossip</strong> 的分布式故障检测和成员协议.</li></ul><p>Dynamo 是完全去中心化的, 对手动运维的需求极低. 存储节点可以在无需任何手动分片或再分配的情况下添加或删除.</p><p>在过去一年中, Dynamo 已经是 Amazon 电商平台中多个核心服务的底层存储技术. 它在繁忙的假日购物季期间能够高效应对极端峰值负载, 并且从未停机. 例如, 购物车服务处理了数百万个请求, 一天内处理了超过 300 万次结账；会话管理服务处理数十万个并发的会话请求.</p><p>本文对学术界的主要贡献在于：评估了如何将不同的技术组合在一起以提供一个高可用的系统. 它证明了最终一致性的存储系统可以用于生产系统, 服务严格的应用程序. 此外, 它还提供了深入的insight, 关于如何调优这些技术以满足生产系统的严格性能需求.</p><h2 id="2-背景"><a class="header-anchor-1" href="#2-背景">#</a>2. 背景</h2><p>Amazon 的电商平台由数百个协同工作的服务组成, 提供从推荐、订单履行到欺诈检测等的各种功能. 每个服务都通过定义明确的 API 公开, 并可以通过网络进行访问. 这些服务托管在遍布世界各地的数据中心中的数万台服务器组成的基础设施上. 其中一些服务是无状态的 (即聚合其他服务响应的服务), 另一些服务则是有状态的 (对持久存储上的状态执行业务逻辑).</p><p>传统生产系统将状态存储在关系数据库中. 然而, 对于许多常见的使用模式而言, 关系数据库并不理想. <strong>这些服务大多数仅通过主键存储和检索数据, 并不需要 RDBMS 提供的复杂查询和管理功能.</strong> 这种额外的功能需要昂贵的硬件和高技能的人员来操作, 使之成为一个非常低效的解决方案. 此外, 可用的复制技术有限, 并且通常更看重一致性(Consistency)而不是可用性(Availability). 尽管近年来有一些进步, 但拓展数据库或者使用智能分片方案进行 load balancing 仍然很困难.</p><p>本文介绍了 Dynamo, 这是一种高可用的数据存储技术, 可以满足这些重要业务的要求. Dynamo 具有简单的 K/V 接口, 并且具有清晰定义的<strong>一致性窗口</strong>, <strong>高资源利用率</strong>, <strong>简单的横向扩展方案</strong>. 每个使用 Dynamo 的服务都运行自己的 Dynamo 实例. (即<strong>服务化部署</strong>)</p><h3 id="2-1-系统假设和需求"><a class="header-anchor-1" href="#2-1-系统假设和需求">#</a>2.1 系统假设和需求</h3><p>这类服务的存储系统有如下的需求:</p><ul><li><strong>查询模型</strong>: 对有唯一键标识的数据项进行简单的读和写操作. 状态表示为二进制对象. 操作不会跨多个数据项, 且不需要关系型模式. 对象相对较小(通常 &lt; 1MB).</li><li><strong>ACID 属性</strong>: Amazon 的经验表明, 提供 ACID 保证的数据存储往往可用性较差, 这一点已经被业界和学术界广泛认可. Dynamo 的目标是那些 A&gt;C 的应用. Dynamo 不提供任何隔离性(I)保证, 并且仅允许单值更新.</li><li><strong>效率</strong>: 系统需要在商用硬件上运行. 在 Amazon 平台上, 服务对延迟有着严格的要求, 通常是以 <strong>p999</strong> 为准. 鉴于状态访问在服务操作中起着至关重要的作用, 存储系统必须能够满足这些严格的 SLA. 服务必须<strong>能够配置</strong> Dynamo 的行为, 以便始终实现其延迟和吞吐量要求. 在性能、性价比、可用性和持久性之间进行权衡.</li><li><strong>其他</strong>: Dynamo 仅供 Amazon 内部服务使用. 其运行环境是可信的, 没有身份验证和授权相关的安全要求. Dynamo 实例的初始设计目标是达到<strong>数百台服务器</strong>的规模.</li></ul><h3 id="2-2-sla"><a class="header-anchor-1" href="#2-2-sla">#</a>2.2 SLA</h3><p>为了确保应用能够在限定时间内完成其功能, 平台中的每个依赖关系都需要提供严格的时间边界. 客户端和服务端之间会约定一个SLA, 对几个系统相关指标达成共识, 其中最突出的是客户对特定 API 的预期请求速率分布以及在这些条件下预期的服务延迟. 一个简单的 SLA 的示例是, 一个服务承诺: 能够在峰值客户端负载为 500 RPS 的情况下, 保证 99.9% 的请求响应时间不超过 300 ms.</p><p>在 Amazon 去中心化的面向服务基础设施中, SLA 起着重要的作用. 例如, 对一个电商网站的页面请求通常需要渲染引擎向超过 150 个服务发送请求. 这些服务往往有多个依赖关系, 这些依赖项通常是其他服务, 因此应用的调用图中经常具有多个层级. 为了保证页面渲染引擎能够清晰地控制界限页面交付, 调用链中的每个服务都必须遵循其 SLA.</p><p>图 1 展示了 Amazon 平台架构的抽象视图, 其中动态 Web 内容由页面渲染组件生成, 而这些组件又会查询许多其他服务. 服务可以使用不同的数据存储来管理其状态, 并且这些数据存储只能在其服务边界内访问. 一些服务充当聚合器, 通过使用多个其他服务来生成复合响应. 通常, 聚合器服务是无状态的, 但它们会使用大量缓存.</p><p>在行业中, 以性能为导向的 SLA 通常使用<strong>平均值</strong>、<strong>中位数</strong>和<strong>预期方差</strong>来描述. 在 Amazon 中我们发现, 如果最终目标是要建立一个让<em>所有</em>（而不是<em>大部分</em>）客户都有良好体验的系统, 则这些指标还不够好. <strong>例如, 如果使用大量的个性化技术, 则具有较长历史记录的客户则需要更多的处理, 这会影响分布高端的性能.</strong> 用平均值或者中位数的 SLA 无法解决这个问题. 为了解决这个问题, Amazon 的 SLA <strong>使用 p999 分位数</strong>. 选择 p999 而不是更高的百分位数是基于成本效益分析得出的, 要继续提高性能, 成本会显著增加. 亚马逊的经验证明, 这种 SLA 方案提供了更好的整体体验.</p><p>本文多次提及 99.9 百分位分布, 这体现了亚马逊工程师从客户体验角度对性能的不懈追求. 许多论文报告的是平均值, 因此本文也仅将其纳入, 以便进行比较. 然而, 亚马逊的工程和优化工作并非专注于平均值. 一些技术, 例如负载均衡的写入 Coordinator 选择, 纯粹是为了将性能控制在 99.9 百分位.</p><p>存储系统通常在确定服务的 SLA 中起着重要的作用, 尤其是在业务逻辑相对轻量级的情况下, 许多 Amazon 的服务就是这样. 在这种情况下, 状态管理就成为服务 SLA 的主要组成部分之一. Dynamo 的主要设计考虑之一是为服务<strong>提供对其系统属性(如持久性和一致性)的控制能力</strong>, 并让服务自行权衡功能、性能和成本效益之间的取舍.</p><h3 id="2-3-设计考虑因素"><a class="header-anchor-1" href="#2-3-设计考虑因素">#</a>2.3 设计考虑因素</h3><p>商业系统中使用的数据复制算法通常执行同步的副本调和, 以提供强一致的数据访问接口. 为了实现这种级别的一致性, 在某些故障场景下, 不得不牺牲数据的可用性. 例如, 相对于处理一个不确定是否正确(correct)的结果, 不如先将数据设置为不可用, 直到能够确定它是正确的为止. 从早期的复制数据库工作开始, 就已知当处理网络故障的可能性时, 强一致性与高可用性不能同时实现. 因此, 此类系统和应用需要了解在哪些条件下可以实现哪些属性.</p><p>对于容易发生服务器和网络故障的系统, 可以通过使用<strong>乐观复制技术</strong>来提高可用性, 这种技术允许在后台将更改传播到副本, 并且容忍并发、断开连接的工作. 这种方法的挑战在于它可能导致<strong>修改冲突</strong>, 必须检测并解决这些更改. 这种冲突解决过程引入了两个问题: <strong>何时解决冲突(when)<strong>以及</strong>谁来解决冲突(who)</strong>. Dynamo 设计为<strong>最终一致</strong>的数据存储：所有更新<strong>最终</strong>都会到达所有副本.</p><p>第一个重要的设计决策是决定<strong>何时解决冲突</strong>, 即是否要在读或写操作时解决冲突. 许多传统数据存储选择在写入期间执行冲突解决, 并保持读取操作简单, 因此在这种系统中, 如果写入操作在给定时间内无法到达多数副本, 则会被拒绝.</p><blockquote><p>即, 当发生网络分区时放弃了写可用性</p></blockquote><p>另一方面, Dynamo 的设计目标为<strong>持续可写</strong>的数据存储 (即数据存储对写入具有高度可用性). 对于亚马逊的某些服务而言, 拒绝客户更新可能会导致较差的客户体验. 例如像购物车服务必须允许客户在其购物车中添加和删除商品, 即使在网络故障和服务器故障期间也是如此. 这一要求迫使我们把冲突解决的复杂性推到读取过程中, 以确保写入永远不会被拒绝.</p><p>下一个设计决策是<strong>谁来解决冲突</strong>. 这可以由数据存储或应用完成. 如果由数据存储进行冲突解决, 其选择就比较有限. 在这种情况下, 数据存储只能使用简单的策略来解决冲突更新, 例如最后写入者获胜 (LWW). 另一方面, 由于应用程序感知数据模式, 它可以决定最合适的冲突解决方法. 例如, 维护客户购物车的应用可以选择将冲突版本合并, 并返回一个统一的购物车. 尽管具有这种灵活性, 一些应用开发人员可能不想编写自己的冲突解决机制, 并将其推送到数据存储中, 而数据存储则会选择简单的方法, 如 LWW.</p><p>设计中包含的其他关键原则是:</p><ul><li><strong>增量式可扩展性</strong>: Dynamo 应该能够<strong>一次扩展一台存储主机</strong>, 对系统运维和系统本身的影响最小.</li><li><strong>对称性</strong>: Dynamo 中的<strong>每个节点都应该具有与其对等节点相同的职责</strong>; 不应该有特殊的节点或节点承担特殊角色或额外的职责. 在我们的经验中, 对称性简化了系统的配置和维护.</li><li><strong>去中心化</strong>: 作为对称性的延伸, 设计应<strong>优先考虑去中心化的点对点技术, 而非集中式控制</strong>. 过去, 集中式控制曾导致过宕机, 而我们的目标是尽可能避免这种情况. 这导致了一个更简单、更具可扩展性和可用性更高的系统.</li><li><strong>异质性</strong>: 系统需要能够利用其运行的基础设施的异质性. 例如, <strong>工作负载分配必须与单个服务器的能力成比例</strong>. 这在添加具有更高容量的新节点而无需一次升级所有主机时至关重要.</li></ul><h2 id="3-相关工作"><a class="header-anchor-1" href="#3-相关工作">#</a>3. 相关工作</h2><h3 id="3-1-p2p-系统"><a class="header-anchor-1" href="#3-1-p2p-系统">#</a>3.1 P2P 系统</h3><p>有几种对等 (P2P) 系统研究过数据存储和分发问题.</p><p>第一代 P2P 系统, 如 <span class="exturl" data-url="aHR0cDovL2ZyZWVuZXRwcm9qZWN0Lm9yZy8=">Freenet<i class="fa fa-external-link-alt"></i></span> 和 <span class="exturl" data-url="aHR0cDovL3d3dy5nbnV0ZWxsYS5vcmcv">Gnutella<i class="fa fa-external-link-alt"></i></span>, 主要用作文件共享系统. 这些是非结构化 P2P 网络的例子, 在这些网络中, 对等节点之间的覆盖链接任意建立. 在这些网络中, 通常通过网络发送搜索查询以找到尽可能多的共享数据的对等节点.</p><p>第二代 P2P 系统即广为人知的<strong>结构化P2P网络</strong>. 这些网络采用全局一致的协议来确保任何节点都可以高效地将搜索查询路由到具有所需数据的某个对等节点. 像 Pastry 和 Chord 这样的系统使用路由机制来保证可以在有限的跳数内回答查询. 为了减少多跳路由引入的额外延迟, 一些 P2P 系统采用了 <code>O(1)</code> 路由, 每个对等节点都维护足够的路由信息, 以便它可以在常数个跳数内将请求(数据项访问)路由到适当的对等节点.</p><p>各种存储系统, 例如 Oceanstore 和 PAST, 都构建在这些路由覆盖层上. Oceanstore 提供了一个全球、事务性、持久化存储服务, 支持对广泛复制数据进行串行更新. 为了允许并发更新并避免广域锁定固有的许多问题, 它使用一种基于冲突解决的更新模型. [21]引入了冲突解决, 以减少事务回滚的次数. Oceanstore 通过处理一系列更新, 在它们之间确定一个全序, 并然后按此顺序原子地应用它们, 来解决冲突. 它专为在不可信基础设施上复制数据的环境而构建. 相比之下, PAST 在 Pastry 之上提供了持久且不可变对象的简单抽象层. 它假设应用可以在其之上构建必要的存储语义(如可变文件).</p><h3 id="3-2-分布式文件系统和数据库"><a class="header-anchor-1" href="#3-2-分布式文件系统和数据库">#</a>3.2 分布式文件系统和数据库</h3><p>文件系统和数据库系统社区已广泛研究如何通过分散数据来提高性能、可用​​性和持久性. 与仅支持扁平命名空间的 P2P 存储系统相比, 分布式文件系统通常支持分层命名空间.</p><ul><li>Ficus 和 Coda 等系统通过复制文件来实现高可用性, 但牺牲了一致性. 更新冲突通常使用专门的冲突解决程序进行管理.</li><li>Farsite 系统 是一个分布式文件系统. 它不使用像 NFS 这样的中央服务器, 而是使用复制来实现高可用性和可扩展性.</li><li>Google 文件系统 (GFS) 是另一个用于托管谷歌内部应用状态的分布式文件系统. GFS 采用简单的设计, 只有一个主服务器来托管整个元数据, 并将数据分成块并存储在块服务器上.</li><li>Bayou 是一个分布式关系数据库系统, 允许离线操作并提供最终的数据一致性.</li></ul><p>在这几个系统中, Bayou、Coda 和 Ficus 允许脱机操作, 并且对网络分区和故障等问题具有鲁棒性. 这些系统的冲突解决程序各不相同:</p><ul><li>Coda 和 Ficus 执行系统级别的冲突解决</li><li>Bayou 则允许应用级别的解决</li></ul><p>然而, 它们都保证了最终一致性. 与这些系统类似, Dynamo 即使在网络分区期间也允许读写操作继续进行, 并使用不同的冲突解决机制来解决更新后的冲突.</p><p>像 FAB 这样的分布式块存储系统将大对象拆分成较小的块, 并以高可用的方式存储每个块. 与其他系统相比, 在这种情况下, 键值存储更合适, 因为:</p><ol><li>键值存储旨在存储相对较小的对象 (&lt;1M),</li><li>键值存储更容易根据应用进行配置.</li></ol><p>Antiquity 是一个广域分布式 (wide-area) 的存储系统, 旨在处理多个服务器故障. 它使用安全日志 (secure log) 来保存数据完整性, 将每个日志复制到多台服务器以确保持久性, 并使用拜占庭容错协议来确保数据的一致性. 相比之下, Dynamo 不关注数据完整性和安全性问题, 并且是为可信环境构建的.</p><p>Bigtable 是一种用于管理结构化数据的分布式存储系统. 它维护一个稀疏的多维有序映射, 并允许应用通过多个属性访问其数据. 相比之下, Dynamo 的目标是仅需要键/值访问的应用, 并且主要关注高可用性, 即使在网络分区或服务器故障的情况下也不会拒绝更新.</p><p>传统的复制关系型数据库系统专注于保证复制数据的强一致性问题. 尽管强一致性为应用编写者提供了方便的编程模型, 但这些系统在可扩展性和可用性方面受到限制. 由于它们通常提供强一致性的保证, 因此这些系统无法处理网络分区问题.</p><h3 id="3-3-讨论"><a class="header-anchor-1" href="#3-3-讨论">#</a>3.3 讨论</h3><p>Dynamo 与上述去中心化存储系统在目标要求方面有所不同.</p><ol><li>Dynamo 主要针对需要<strong>持续可写</strong>的数据存储应用, 这些应用不允许由于故障或并发写入而拒绝更新. 这对于许多 Amazon 应用至关重要.</li><li>Dynamo 是为单个管理域内的基础设施构建的, 在该基础设施中所有节点都被假设为<strong>可信的</strong>.</li><li>使用 Dynamo 的应用<strong>不需要</strong>支持层次化的命名空间 (许多文件系统的常态) 或复杂的关系模式 (传统数据库支持).</li><li>Dynamo 专为延迟敏感型应用程序设计, 要求读取和写入操作的<strong>延迟 p999 必须在几百毫秒内</strong>. 为了满足这些严格的延迟要求, 我们避免通过多个节点路由请求 (这是几个分布式哈希表系统, 例如 Chord 和 Pastry 所采用的典型设计), 这是因为<strong>多跳路由会增加响应时间的变异性, 并且在更高百分位数时增加延迟</strong>. Dynamo 可以被描述为<strong>零跳 DHT</strong>, 其中每个节点在其本地维护足够的路由信息以直接将请求路由到适当的节点.</li></ol><h2 id="4-系统架构"><a class="header-anchor-1" href="#4-系统架构">#</a>4. 系统架构</h2><p>需要在生产环境中运行的存储系统架构非常复杂. 除了实际的数据持久化组件外, 该系统还需要具有可扩展且稳健的解决方案, 解决这些问题:</p><ul><li>负载均衡</li><li>成员发现和故障检测</li><li>故障恢复</li><li>复制同步</li><li>过载处理</li><li>状态转移</li><li>并发性和作业调度</li><li>请求编组</li><li>请求路由</li><li>系统监控和报警</li><li>配置管理</li></ul><p>本文重点介绍了 Dynamo 中使用的分布式系统技术的核心: 分片、复制、版本控制、成员资格、故障处理和扩缩容.</p><table><thead><tr><th>问题</th><th>采用的解决方案技术</th><th>优势</th><th>Apache Cassandra</th><th>Riak</th></tr></thead><tbody><tr><td>数据分片 (partition)</td><td>一致性哈希</td><td><strong>增量式可扩展性</strong></td><td>√</td><td>√</td></tr><tr><td>持续可写 (写高可用)</td><td>向量时钟</td><td>版本大小与更新速率解耦</td><td>LWW</td><td>√</td></tr><tr><td>临时故障处理</td><td>宽松 Quorum 和提示 handoff</td><td>当某些副本不可用时提供高可用性和持久性保证</td><td>√</td><td>√</td></tr><tr><td>从永久故障中恢复</td><td>使用 Merkle 树进行反熵</td><td>在后台同步分歧的副本</td><td>√</td><td>√</td></tr><tr><td>成员发现和故障检测</td><td>基于 Gossip 的成员协议和故障检测</td><td>保持<strong>对称性</strong>并避免集中式注册中心来存储成员和节点存活信息</td><td>√</td><td>√</td></tr></tbody></table><h3 id="4-1-接口"><a class="header-anchor-1" href="#4-1-接口">#</a>4.1 接口</h3><p>Dynamo 通过简单的接口存储与键关联的对象；它暴露了两个操作: <code>get</code> 和 <code>put</code>.</p><ul><li><code>get(key)</code> 操作在存储系统中定位与键相关的对象副本, 并返回单个对象, 或一个冲突版本的对象列表以及 context .</li><li><code>put(key, context, object)</code> 操作根据关联的键确定对象的副本应放置的位置, 并将副本写入磁盘.</li></ul><p>context 对对象的系统元数据进行编码, 该元数据对调用者是不透明的, 并包括诸如对象版本的信息. context 信息与对象一起存储, 以便系统可以验证提供的 context 对象的有效性.</p><p>Dynamo 将由调用者提供的键和对象都视为不透明的字节数组. 它对键应用 MD5 散列以生成 128 位标识符, 该标识符用于确定负责服务 Key 的存储节点.</p><h3 id="4-2-数据分片"><a class="header-anchor-1" href="#4-2-数据分片">#</a>4.2 数据分片</h3><p><img src="image2.avif" alt="image2"></p><p>Dynamo 的关键设计要求之一是它必须按增量式方式扩展. 这需要一种机制来<em>动态地</em>将数据分布在系统中的节点上. Dynamo 的分片方案依赖于<strong>一致性哈希</strong>来在多个存储主机之间分配负载. 在一致性哈希中, 哈希函数输出范围被处理为固定圆环空间或“环”(即最大哈希值会循环到最小哈希值). 每个系统中的节点都被分配一个随机值在这个空间内, 代表其“位置”在环上. 每个由键标识的数据项通过将数据项的键进行哈希以获得其在环上的位置, 并然后顺时针沿着环找到第一个位置大于该数据项的位置的第一个节点而分配给一个节点. 因此, 每个节点都负责环上其前一个节点和它之间的区域. 一致性哈希的优点是, 节点的离开或到达仅影响其直接邻居, 而其他节点不受影响.</p><blockquote><p>传统的做法：使用 <code>mod</code> 函数将数据项映射到节点上.</p><p>这种方法的问题在于, 当节点数量发生变化时, 大量数据项需要重新映射到不同的节点上. 这会导致大量的数据迁移, 并且在节点频繁变化的环境中效率低下.</p></blockquote><p>基本的一致性哈希算法存在一些挑战:</p><ol><li>环上的每个节点的随机位置分配导致数据和负载分布不均匀.</li><li>基本算法忽略了节点的异质性.</li></ol><p>为了应对这些问题, Dynamo 使用了一种一致性哈希变体: 相对于将一个节点映射到圆圈中的单个点上, 每个节点被分配到多个环上的点上. 为此, Dynamo 使用了“虚拟节点”的概念. 一个虚拟节点看起来像系统中的一个节点, 但每个节点可以负责多个虚拟节点. 简而言之, 在系统中添加一个新的节点时, 它会被分配到环上的多个位置(以后称为“令牌”). Dynamo 分区方案的微调过程将在第 6 节讨论.</p><p>使用虚拟节点具有以下优点:</p><ul><li>如果一个节点变得不可用 (由于故障或例行维护), 由该节点处理的负载将<strong>均匀地</strong>分散到剩余可用节点上.</li><li>当一个节点再次可用, 或系统中添加了一个新节点时, 新的可用节点将从其他可用节点接收<strong>大致相等</strong>的负载量.</li><li>节点负责的虚拟节点数量可以根据其容量来决定, 以考虑物理基础设施的<strong>异质性</strong>.</li></ul><blockquote><p>一致性哈希的计算开销: 一次哈希计算和一次环上查找 (使用跳表或类似的数据结构实现), O(log N).</p></blockquote><h3 id="4-3-数据复制"><a class="header-anchor-1" href="#4-3-数据复制">#</a>4.3 数据复制</h3><p>为了实现高可用性和持久性, Dynamo 在多个主机上复制其数据. 每个数据项都会存储在 N 个不同的主机上, N 是一个实例级别的配置参数.</p><p>每个键都对应一个 Coordinator 节点. Coordinator 节点负责复制数据项到它应该属于的范围. 除了本地存储每个范围内的键外, Coordinator 节点还会将这些键复制到环形中的顺时针方向上的 N-1 个节点. 最终系统中, 每个节点对其与第 N 个前驱之间的环形区域负责. 例如在图 2 中, 位于 <code>(A, B]</code> 之间的键 <code>k</code> 将被存储在节点 <code>B</code>、<code>C</code> 和 <code>D</code> 上. 节点 <code>D</code> 将存储属于范围 <code>(A, B]</code>、<code>(B, C]</code> 和 <code>(C, D]</code> 内的键.</p><blockquote><p>Coordinator 节点: 哈希环上顺时针方向上第一个位置大于 Key 的节点.</p></blockquote><p>负责存储特定 Key 的节点列表称为该 Key 的 <strong>偏好列表 (Preference list)</strong>. 系统被设计为每个节点都可以确定任何特定 Key 的 Preference list. 为了应对节点故障, Preference list 包含超过 N 个节点. 注: 在使用了虚拟节点的情况下, Preference list 可能包含重复的物理节点. 在这种情况下, 会跳过环上的位置以确保列表仅包含不同的物理节点.</p><blockquote><p>Preference list: 哈希环上后继 &gt;N 个不同的物理节点.</p></blockquote><h3 id="4-4-多版本控制"><a class="header-anchor-1" href="#4-4-多版本控制">#</a>4.4 多版本控制</h3><p>Dynamo 提供<em>最终一致性</em>, 更新操作会<strong>异步地</strong>传播到所有副本. 一个 <code>put</code> 调用可能在所有副本应用更新之前就返回给调用者, 这可能导致后续的 <code>get</code> 操作可能返回一个旧的对象. 如果没有发生故障, 更新在有限时间内即可完成. 然而, 在某些故障场景下(例如服务器停机或网络分区), 更新可能需要较长时间才能到达所有副本.</p><p>Amazon 平台中有些应用程序可以容忍这种不一致, 并且可以在这些条件下运行. 例如, 购物车应用要求“添加到购物车”的操作永远不会被遗忘或拒绝. 如果最新的购物车状态不可用, 用户对老版本的购物车状态进行了更改, 则该更改仍然是有意义的并且应该保留. 但同时, 它不应该取代当前不可用的购物车状态, 而该状态本身可能包含应保留的变化. 注: “添加到购物车”和“从购物车删除商品”操作都被翻译成 Dynamo 中的 put 请求. 当客户想要将增加/删除购物车中的商品, 而且最新版本不可用时, 该变更会被施加到较旧版本中, 并且不同的版本稍后会进行合并.</p><p>为了提供这种保证, Dynamo 将每个修改的结果视为一个新的、不可变的数据版本. 它允许系统中同时存在<strong>一个对象的多个版本</strong>. 大多数情况下, 新版本会覆盖之前的版本(语法调和 syntactic reconciliation), 并且系统本身可以确定权威版本(语义调和 semantic reconciliation). 然而, 在存在故障和并发更新的情况下可能会发生版本分叉, 从而导致对象出现冲突版本.</p><blockquote><p>参考共享文档编辑系统中的冲突情况.</p></blockquote><p>在这种情况下, 存储系统无法对同一对象的多个版本进行一致化处理, 客户端必须执行一致化操作以将数据演进的多个分叉合并回一个 (语义调和 semantic reconciliation). 典型的合并操作示例是“合并”不同版本的客户购物车. 使用这种调和机制, “添加到购物车”的操作永远不会丢失. 但是, 被删除的商品可能会重新出现.</p><blockquote><p>对于购物车场景, 这通常是可以接受的, 因为客户可以在结账时删除不需要的商品. 也符合电商网站的商业目标, 即尽可能多地销售商品.</p></blockquote><p>重要的是要理解某些故障模式可能会导致系统不仅有两份, 而是多份相同的数据. 在存在网络分区和节点故障的情况下进行更新可能导致对象具有不同的版本子历史记录, 而该系统将来需要解决这个问题. 这要求我们设计应用来明确承认同一数据的多个版本的可能性 (以确保不会丢失任何更新).</p><p>Dynamo 使用向量时钟来捕获同一对象的不同版本之间的<strong>因果关系</strong>. 一个向量时钟实际上是一个 <code>(节点, 计数器)</code> 对的列表. 每个对象的所有版本都关联一个向量时钟. 通过检查向量时钟, 可以确定两个对象的版本是否在并行分支上还是具有因果顺序. 如果第一个对象的时钟上的计数器小于等于第二个时钟中的所有节点, 则第一个是第二个的祖先, 并且可以被遗忘. 否则, 这两个更改被认为是冲突并且需要进行调和.</p><p>在 Dynamo 中, 当客户端希望更新对象时, 它必须指定要更新的版本. 这是通过传递先前读取操作获得的 context 来完成的, context 中包含向量时钟信息. 处理读请求时, 如果 Dynamo 访问了多个无法语法上调和的分支, 它将返回所有叶子对象, 并在 context 中包含相应的版本信息. 使用此 context 进行更新被认为是已调和了不同的版本, 并且分支会合并为一个新版本.</p><p><img src="image.avif" alt="alt text"></p><p>为了说明向量时钟的使用, 让我们考虑上图所示的例子. 客户端写入新对象. 处理此 Key 的节点(假设是 Sx)增加其序列号, 并将其用于创建数据的向量时钟. 现在系统拥有对象 D1 及其关联的时钟<code>[(Sx, 1)]</code>. 客户端更新该对象. 假设同一节点也处理了这个请求. 现在系统还拥有对象 D2 及其关联的时钟<code>[(Sx, 2)]</code>. D2 从 D1 继承而来, 因此会覆盖 D1, 但是可能在尚未看到 D2 的节点上仍然存在 D1 的副本. 让我们假设相同的客户端再次更新该对象并由不同的服务器(假设是 Sy)处理请求. 现在系统拥有数据 D3 及其关联的时钟<code>[(Sx, 2), (Sy, 1)]</code>.</p><p>接下来假设一个不同的客户端读取 D2, 然后尝试更新它, 并且另一个节点(假设为 Sz)进行写入. 现在系统中有 D4(D2 的后代), 其版本时钟为<code>[(Sx, 2), (Sz, 1)]</code>. 一个知道 D1 或 D2 的节点, 在收到 D4 及其时钟后, 可以确定 D1 和 D2 被新数据覆盖并可以进行垃圾回收. 一个知道 D3 并且接收 D4 的节点会发现它们之间没有因果关系. 换句话说, D3 和 D4 中的变化在彼此之间没有反映出来. 这两个版本的数据必须保持并呈现给客户端(在读取时)以实现语义上的调和.</p><p>现在假设一些客户端读取了 D3 和 D4 (context 将反映这两个值都是通过读取找到的). 读取的 context 是 D3 和 D4 时钟的摘要, 即<code>[(Sx, 2), (Sy, 1), (Sz, 1)]</code>. 如果客户端执行调和并节点 Sx 调和写入, 则 Sx 会更新其时钟中的序列号. 新数据 D5 将具有以下时钟: <code>[(Sx,3), (Sy, 1), (Sz, 1)]</code>.</p><p>向量时钟的一个可能的问题是, 如果许多服务器调和对同一个对象的写入, 则向量时钟的大小可能会增长. 在实践中, 这不太可能, 因为写操作通常由 Preference list 中前 N 个节点中的一个处理. 在网络分区或多个服务器故障的情况下, 写请求可能会由不在 Preference list 中前 N 个节点的节点处理, 导致向量时钟的大小增长. 在这种情况下, 限制向量时钟的大小是可取的. 为此, Dynamo 采用了以下截断方案: 与每个 (node, counter) 对一起存储一个时间戳, 指示节点最后一次更新数据项的时间. 当向量时钟中的 (node, counter) 对的数量达到阈值(例如 10)时, 最旧的一对将从时钟中删除. 显然, 这种截断方案会导致合并过程中的效率低下, 因为后代关系无法准确推导出来. 然而, 在生产环境中尚未出现过这个问题, 因此还没有得到彻底调查.</p><h3 id="4-5-执行-get-和-put-操作-无故障"><a class="header-anchor-1" href="#4-5-执行-get-和-put-操作-无故障">#</a>4.5 执行 <code>get</code> 和 <code>put</code> 操作 (无故障)</h3><p>Dynamo 中的任何存储节点都可接收客户端的 <code>get</code> 和 <code>put</code> 操作. 在本节中, 为了简单起见, 我们先描述这些操作在无故障的情况下如何执行, 在下一节中, 我们将描述在发生故障期间如何执行读写操作.</p><p><code>get</code> 和 <code>put</code> 都是通过使用 Amazon 的 HTTP RPC 框架进行调用. 客户端可以使用两种策略来访问 Dynamo:</p><ol><li><strong>Proxy</strong>: 将其请求路由到一个通用 Load Balancer, 该 Load Balancer 将根据负载信息选择节点<ul><li>优点: 客户端不需要在应用中链接任何与 Dynamo 相关的代码</li></ul></li><li><strong>Smart Client</strong>: 使用感知分区的客户端库直接将请求路由到适当的 Coordinator 节点.<ul><li>优点: 可以实现更低的延迟, 因为它跳过了可能的转发步骤</li></ul></li></ol><p>处理读写操作的节点被称为 Coordinator, 通常是 Preference list 中的第一个成员. 在 Proxy 模式下, Proxy 会将请求随机转发给集群中的任意一个节点, 该节点再将请求转发给真正的 Coordinator 节点.</p><p>读写操作只会涉及 Preference list 中的前 N 个健康节点, 跳过那些已下线或不可访问的节点. 当所有节点都处于健康状态时, 会访问一个 Key 的 Preference list 中排名最高的 N 个节点. 在出现节点故障或网络分区的情况下, 会访问 Preference list 中排名较低的节点.</p><p>为了保持其副本的一致性, Dynamo 使用类似于 Quorum 系统的一致性协议. 该协议有两个关键可配置值: R 和 W.</p><ul><li>R 是成功读取操作必须参与的最小节点数</li><li>W 是成功写入操作必须参与的最小节点数</li></ul><p>将 R 和 W 设置为 <code>R + W &gt; N</code> 就得到一个类似 Quorum 的系统. 在这个模型中, get/put 操作的延迟将由 R/W 中的最慢副本决定. 因此, 通常会选择小于 N 的 R + W, 以提供更好的延迟.</p><p>在收到对 Key 的 <code>put</code> 请求时, Coordinator 生成新版本的向量时钟, 并将新版本写入本地. 然后, Coordinator 将新版本(包括新向量时钟)发送到排名最高的 N 个可达节点. 如果至少有 W-1 个节点响应, 则这次写入操作被认为是成功的.</p><p>同样, 对于一个 <code>get</code> 请求, Coordinator 从 Preference list 中排名最高的 N 个可达节点请求该 Key 的所有现有版本的数据, 并且在等待 R 个响应后返回结果给客户端. 如果 Coordinator 最终收集了多个数据版本, 则它会返回所有认为与当前版本无关的版本. 然后将这些不同版本进行调和, 并将调和后的版本写回.</p><h3 id="4-6-处理临时故障-提示式移交"><a class="header-anchor-1" href="#4-6-处理临时故障-提示式移交">#</a>4.6 处理临时故障: 提示式移交</h3><p>如果 Dynamo 使用传统的 Quorum 方法, 那么在服务器故障和网络分区期间将完全不可用, 并且即使在最简单的故障条件下也会降低持久性. 为了解决这个问题, 它不强制执行严格的 Quorum 检查, 而是使用一种<strong>宽松的 Quorum</strong>: 所有读写操作都在 Preference list 中的前 N 个健康节点上进行, 这些节点不一定是哈希环中顺时针的前 N 个节点.</p><p>考虑图 2 中 <code>N = 3</code> 的 Dynamo 配置示例. 在此示例中, 如果在写操作期间节点 A 暂时不可用或无法访问, 则原本在 A 上的数据的副本将被发送到节点 D. 这是为了保持所需的可用性和持久性保证而进行的操作. 发送给 D 的副本将在其元数据中包含一个提示, 表明哪个节点才是该副本的预期接收者 (在这种情况下为 A). 收到提示副本的节点会将其保存在一个单独的本地数据库中, 并定期扫描该数据库. 检测到 A 已恢复后, D 会将尝试向 A 交付副本. 一旦传输成功, D 可以从其本地存储中删除对象, 而不必减少系统中的总副本数量.</p><p>Dynamo 使用提示式移交机制确保读写操作不会因临时节点或网络故障而失败. 需要最高可用性的应用可以将 W 设置为 1, 这保证只要系统中有一个节点 Key 写入其本地存储, 则写请求就会被接受. 只有所有节点都不可用, 才会拒绝写入请求. 然而, 在实践中, 大多数亚马逊服务在生产环境中设置了更高的 W 以满足所需的持久性级别. 有关配置 N、R 和 W 的更详细讨论请参见第 6 节.</p><p>高可用存储系统必须能够处理整个数据中心的故障. 数据中心故障可能由于停电、冷却失败、网络故障或自然灾害引起. Dynamo 通过配置, 使得每个对象在多个数据中心进行复制. 本质上, Key 的 Preference list 被构造成以使存储节点分布在多个数据中心中. 这些数据中心通过高速网络连接. 这种跨多个数据中心复制的方法允许我们处理整个数据中心的故障而不会出现数据中断.</p><h3 id="4-7-处理永久性故障-副本同步"><a class="header-anchor-1" href="#4-7-处理永久性故障-副本同步">#</a>4.7 处理永久性故障: 副本同步</h3><p>提示式移交在系统成员流失率低且节点故障是暂时的情况下效果最好. 有些场景下, 提示副本可能在移交给原始节点之前也不可用了. 为了处理这种情况对持久性的威胁, Dynamo 实现了一个反熵 (副本同步) 协议来保持副本同步.</p><p>为了更快地检测副本之间的不一致性和最小化传输的数据量, Dynamo 使用 Merkle 树. Merkle 树是一种哈希树, 其中叶子是单个键值的哈希. 树中更高层次的父节点是其子节点的哈希. Merkle 树的主要优点在于每个分支可以独立检查而无需节点下载整个树或整个数据集. 此外, Merkle 树有助于减少在检查副本之间的一致性时需要传输的数据量. 例如, 如果两个树根的哈希值相等, 则树中的叶节点的值也相等, 并且节点不需要同步. 否则, 这意味着某些副本的值不同. 在这种情况下, 节点可能交换孩子的哈希值并继续进行直到达到树的叶子, 在这一点上主机可以识别“脱节”的 Key. Merkle 树减少了用于同步所需传输的数据量, 并降低了反熵过程中读取磁盘的数量.</p><p>Dynamo 使用 Merkle 树来反熵, 如下所示: 每个节点维护一个单独的 Merkle 树, 以覆盖它所托管的关键范围(虚拟节点所涵盖的一组 Key). 这允许节点比较它们是否在关键范围内具有最新的 Key. 在这个方案中, 两个节点交换它们共同拥有的 Key 范围对应的 Merkle 树根. 随后, 通过上面描述的树遍历方案, 节点确定是否有任何差异并执行适当的同步操作. 这种方案的一个缺点是, 在节点加入或离开系统时, 许多 Key 范围会发生变化, 因此需要重新计算树. 然而, 这个问题可以通过第 6.2 节中描述的细化分区方案得到解决.</p><h3 id="4-8-成员和故障检测"><a class="header-anchor-1" href="#4-8-成员和故障检测">#</a>4.8 成员和故障检测</h3><h4 id="4-8-1-环形成员检测"><a class="header-anchor-1" href="#4-8-1-环形成员检测">#</a>4.8.1 环形成员检测</h4><p>在 Amazon 的环境中, 由于故障和维护任务而导致的节点掉线通常是短暂的, 但也可能会持续更长的时间. 节点掉线很少意味着永久离开, 因此不应该分区分配重新平衡或无法访问副本的修复. 同样, 人为错误可能导致无意中启动新的 Dynamo 节点. 因此, 使用明确机制来增加和删除 Dynamo 环中的节点是合适的.</p><p>管理员通过命令行工具或浏览器连接到 Dynamo 节点, 并向该节点发出成员资格更改指令. 请求服务的节点将成员资格更改及其发布时间写入持久存储. 因为节点可以多次被添加和删除, 成员资格更改形成历史记录. 基于 Gossip 的协议会传播成员资格更改并保持最终一致的成员资格视图. 每个节点每秒会随机选择一个 Peer 进行联系, 两个节点高效地调和它们的持久成员资格更改历史记录.</p><p>当 Dynamo 节点首次启动时, 它先选择其令牌集(一致哈希空间中的虚拟节点)并映射节点到各自的令牌集中. 该映射会持久化在磁盘上, 最初仅包含本地节点和令牌集. 在相同通信交换中, 不同 Dynamo 节点存储的映射会进行合并以解决成员变更历史记录. 因此, 分片和放置信息也会通过基于 Gossip 协议传播, 并且每个存储节点都了解其 Peer 处理的令牌范围. 这使每个节点能够直接将 Key 的读写操作转发到正确的节点集合.</p><h4 id="4-8-2-外部服务发现"><a class="header-anchor-1" href="#4-8-2-外部服务发现">#</a>4.8.2 外部服务发现</h4><p>上述机制可能会暂时导致逻辑上分区的 Dynamo 环. 例如, 管理员可以联系节点 A 以将 A 加入到环中, 然后联系节点 B 以将 B 加入到环中. 在这种情况下, 节点 A 和 B 都会认为自己是环的一部分, 但它们都不会立即意识到对方的存在. 为了防止逻辑分区, 一些 Dynamo 节点扮演种子的角色. 种子是通过外部机制发现的节点, 并且所有节点都知道这些种子. 因为最终所有节点都将与种子进行成员身份匹配, 因此逻辑分区的可能性极低. 种子可以从静态配置或配置服务中获取. 通常, 种子节点是 Dynamo 环中的完全正常工作的节点.</p><h4 id="4-8-3-故障检测"><a class="header-anchor-1" href="#4-8-3-故障检测">#</a>4.8.3 故障检测</h4><p>在 Dynamo 中故障检测用于避免在 <code>get</code> 、<code>put</code>、分片迁移和提示副本传输期间尝试与不可达的对等方进行通信. 为了防止通信失败, 使用纯粹本地的故障检测概念完全足够: 节点 A 可能认为节点 B 已失败, 即使 B 对节点 C 的消息响应. 当 Dynamo 环中有稳定的客户端请求速率时, 在节点 B 失败且不响应消息的情况下, 节点 A 很快就会发现节点 B 是无响应的；然后节点 A 使用备用节点来服务映射到 B 的分片的请求；定期重试 B 以检查其恢复情况. 在没有客户端请求驱动两个节点之间的流量的情况下, 任何节点都不需要知道另一个是否可达和响应.</p><p>去中心化故障检测协议使用一种简单的 Gossip 式协议, 使系统中的每个节点都能了解到其他节点的到达(或离开). 有关去中心化故障检测器及其影响准确性的参数的详细信息, 请参阅[8]. Dynamo 的早期设计使用去中心化故障检测器来维护全局一致的失败状态视图. 后来确定了明确的节点加入和离开方法消除了对全局失败状态视图的需求. 这是因为通过明确的节点加入和离开方法通知节点永久性节点添加和删除, 并且当节点无法与其他节点通信时(在转发请求时), 由单个节点检测临时节点故障.</p><h3 id="4-9-添加-删除存储节点"><a class="header-anchor-1" href="#4-9-添加-删除存储节点">#</a>4.9 添加/删除存储节点</h3><p>当一个新的节点(例如 X)被添加到系统中时, 它会分配一些随机散落在环上的令牌. 对于分配给节点 X 的每个键范围, 可能有多个节点(小于或等于 N)目前负责处理其令牌范围内的键. 由于将键范围分配给 X, 一些现有节点不再需要某些键, 并且这些节点将这些键转移到 X. 让我们考虑一个简单的 Bootstrap 场景, 其中节点 X 添加到图 2 中所示的环之间 A 和 B. 当 X 添加到系统时, 它负责存储范围 <code>(F, G]</code>, <code>(G, A]</code> 和 <code>(A, X]</code> 的键. 因此, 节点 B、C 和 D 不再需要存储这些相应的范围中的键. 因此, 节点 B、C 和 D 将向 X 提供相应的键值, 并在 X 确认后转移相应的键值集. 当一个节点从系统中移除时, 键值的重新分配过程将以相反的过程进行.</p><p>运维经验表明, 这种方法可以将 Key 分发的负载均匀地分布在存储节点上, 这对于满足延迟要求和确保快速启动至关重要. 最后, 在源和目的地之间添加确认轮次, 以确保目的地节点不会接收给定 Key 范围内的任何重复传输.</p><h2 id="5-实现"><a class="header-anchor-1" href="#5-实现">#</a>5. 实现</h2><p>在 Dynamo 中, 每个存储节点都有三个主要的软件组件: 请求协调、成员资格和故障检测、以及本地持久性引擎. 所有这些组件都是用 Java 实现的.</p><p>Dynamo 的本地持久性组件允许使用不同的存储引擎. 正在使用的引擎包括:</p><ul><li>Berkeley 数据库 (BDB) 事务数据存储</li><li>BDB Java 版</li><li>MySQL</li><li>具有持久存储后端的内存缓冲区</li></ul><p>设计可插拔持久性组件的主要原因是选择最适合应用访问模式的存储引擎. 例如, BDB 可以处理通常在数十 KB 范围内的对象, 而 MySQL 则可以处理更大的对象. 应用根据其对象大小分布选择 Dynamo 的本地持久性引擎. 大多数 Dynamo 生产实例都使用 BDB 事务数据存储.</p><p>请求协调组件构建于事件驱动的消息传递基础之上, 该消息处理管道被划分为多个阶段类似于 SEDA 架构. 所有通信都使用 Java NIO 通道实现. Coordinator 通过从一个或多个节点 (读取情况下) 收集数据, 或存储数据在一个或多个节点上 (写入情况下), 代表客户执行读取和写入请求.</p><p>每个客户端请求都会导致接收客户端请求的节点创建状态机. 状态机包含所有用于识别负责 Key 的节点、发送请求、等待响应、可能进行重试、处理答复并包装响应给客户的逻辑. 每个状态机实例仅处理一个客户端请求. 例如, 读操作实现以下状态机:</p><ol><li>向节点发送读取请求</li><li>等待所需响应的最小数量 R</li><li>如果在给定时间内收到太少的回复, 则失败请求</li><li>否则收集所有数据版本, 并确定要返回的版本</li><li>如果启用版本控制, 则执行语法调和, 并生成包含所有剩余版本的不可见写 context .</li></ol><p>为了简洁起见, 错误处理和重试状态被省略了.</p><p>在读响应已返回给调用者后, 状态机等待一小段时间以接收任何未完成的响应. 如果在任何响应中返回了过期版本, Coordinator 会更新这些节点的最新版本. 此过程称为读取修复, 因为它会在机会时间修复错过最近更新的副本, 并且可以减轻反熵协议不必执行该操作的压力.</p><p>如前所述, 写请求由 Preference list 中前 N 个节点中的一个协调. 尽管第一个节点协调写入操作从而在单个位置上串行所有写入操作是理想的, 但这种方法导致负载不均匀分布, 进而违反了 SLA. 这是因为请求负载不是在整个对象之间均匀分布的. 为了应对这种情况, 在 Preference list 的前 N 个节点中任何一个都可以协调写入操作. 特别是, 由于每个写通常跟随读取操作, 因此选择写入 Coordinator 为回复最快到先前读取操作的节点, 该读取操作存储在请求 context 中. 这种优化使我们能够选择读取了先前读取操作的数据所在的节点, 从而增加了获得 “read-your-writes” 的一致性机会. 它还减少了请求处理性能的变异性, 这提高了 p999 的性能.</p><h2 id="6-经验和教训"><a class="header-anchor-1" href="#6-经验和教训">#</a>6. 经验和教训</h2><p>Dynamo 被几个具有不同配置的服务使用. 这些实例通过版本对齐逻辑和读写 Quorum 特征各不相同. 以下是在 Dynamo 中使用的主模式:</p><ul><li>业务逻辑特定的对齐: 这是 Dynamo 的一个流行用例. 每个数据对象在多个节点上进行复制. 如果版本不同, 客户端应用会执行自己的对齐逻辑. 前面讨论过的购物车服务就是一个此类别中的典型例子. 其业务逻辑通过合并客户购物车的不同版本来对齐对象.</li><li>基于时间戳的对齐: 此案例与前面的一个案例不同之处仅在于对齐机制. 在存在分歧版本的情况下, Dynamo 会执行简单的基于时间戳的“最后写入胜出”逻辑；即选择物理时间戳值最大的对象作为正确版本. 维护客户会话信息的服务是一个使用这种模式的好例子.</li><li>高性能读取引擎: 虽然 Dynamo 是为“始终可写入”的数据存储而构建的, 但一些服务正在调整其共识特性并将其用作高性能读取引擎. 通常, 这些服务具有较高的读请求率和少量更新. 在这种配置中, 通常 R 设置为 1, W 设置为 N. 对于这些服务, Dynamo 提供将数据在多个节点之间分区和复制的能力, 从而实现增量式扩展. 其中一些实例充当了存储在更重负载后备存储中的数据的权威持久缓存. 维护产品目录和服务项目的服务属于此类别.</li></ul><p>Dynamo 的主要优势在于, 其客户端应用可以调整 N、R 和 W 的值以达到所需的性能、可用性和持久性水平. 例如, N 的值决定了每个对象的持久性. Dynamo 用户通常使用的 N 值为 3.</p><p>W 和 R 的值会影响对象可用性、持久性和一致性. 例如, 如果将 W 设置为 1, 则只要系统中至少有一个节点可以成功处理写入请求, 系统就不会拒绝任何写入请求. 然而, 低值的 W 和 R 可能会增加不一致的风险, 因为即使大多数副本未处理写入请求, 也会认为写入请求成功并将其返回给客户端. 这也引入了一个持久性的脆弱窗口, 当写入请求成功返回给客户端时, 尽管它仅在少数节点上被持久化.</p><p>传统观点认为, 持久性和可用性密不可分. 然而, 这在这里并不一定成立. 例如, 可以通过增加 W 来减少持久性的脆弱性窗口. 这可能会增加拒绝请求的概率（从而降低可用性）, 因为需要更多存储主机保持活动状态才能处理写入请求.</p><p>Dynamo 的多个实例使用的常见 (N,R,W) 配置为 (3,2,2). 选择这些值是为了满足必要的性能、持久性、一致性和可用性 SLA 要求.</p><p>本节中介绍的所有测量均在 (3,2,2) 配置的实时系统上进行, 该系统运行着数百个具有相同硬件配置的节点. 如前所述, 每个 Dynamo 实例都包含位于多个数据中心的节点. 这些数据中心通常通过高速网络链路连接. 回想一下, 为了生成成功的 get（或 put）响应, R（或 W）个节点需要响应 Coordinator. 显然, 数据中心之间的网络延迟会影响响应时间, 并且节点（及其数据中心位置）的选择应满足应用程序的目标 SLA.</p><h3 id="6-1-平衡性能和持久性"><a class="header-anchor-1" href="#6-1-平衡性能和持久性">#</a>6.1 平衡性能和持久性</h3><p>虽然 Dynamo 的主要设计目标是构建一个高可用的数据存储, 但性能也是亚马逊平台同样重要的考量标准. 如前所述, 为了提供一致的客户体验, 亚马逊的服务将其性能目标设定在更高的百分位（例如 99.9 或 99.99 百分位）. 对于使用 Dynamo 的服务, 一个典型的 SLA 要求是 99.9% 的读写请求在 300 毫秒内执行.</p><p>由于 Dynamo 运行在标准商用硬件组件上, 其 I/O 吞吐量远低于高端企业服务器, 因此提供持续的高性能读写操作并非易事. 读写操作涉及多个存储节点, 这使得它更具挑战性, 因为这些操作的性能受到最慢的读或写副本的限制. 图 4 显示了 Dynamo 在 30 天内读写操作的平均延迟和 99.9 百分位延迟. 从图中可以看出, 延迟呈现出明显的昼夜变化模式, 这是由于传入请求率的昼夜变化模式造成的（即白天和晚上的请求率有显著差异）. 此外, 写入延迟明显高于读取延迟, 因为写入操作总是会导致磁盘访问. 此外, 99.9 百分位延迟约为 200 毫秒, 比平均值高出一个数量级. 这是因为第 99.9 个百分位延迟受到请求负载、对象大小和局部模式的变化等多种因素的影响.</p><p>虽然这种性能水平对于许多服务来说是可以接受的, 但一些面向客户的服务需要更高的性能. 对于这些服务, Dynamo 提供了在性能和持久性之间进行权衡的能力. 在优化中, 每个存储节点在其主内存中维护一个对象缓冲区. 每个写操作都存储在缓冲区中, 并由写入线程定期写入存储. 在此方案中, 读操作首先检查请求的键是否存在于缓冲区中. 如果存在, 则从缓冲区而不是存储引擎读取对象.</p><p>这种优化使得在高峰流量期间即使对于只有一千个对象的非常小的缓冲区, 99.9 百分位延迟也降低了 5 倍（见图 5）. 此外, 如图所示, 写入缓冲可以平滑更高百分位延迟. 显然, 这种方案以持久性换取性能. 在此方案中, 服务器崩溃可能导致缓冲区中排队的写入丢失. 为了降低持久性风险, 写入操作被改进为让协调器从 N 个副本中选择一个来执行“持久写入”. 由于协调器仅等待 W 个响应, 因此写入操作的性能不受单个副本执行的持久写入操作的性能影响.</p><h3 id="6-2-确保均匀负载分布"><a class="header-anchor-1" href="#6-2-确保均匀负载分布">#</a>6.2 确保均匀负载分布</h3><p>Dynamo 使用一致性哈希在其副本之间划分键空间, 以确保负载均匀分布. 假设键的访问分布不是高度倾斜, 均匀的键分布可以帮助我们实现均匀的负载分配. 具体而言, Dynamo 的设计假设即使在访问分布中存在显著的倾斜, 在分布的热门端也有足够的键, 因此处理热门键的负载可以通过分区均匀地分布在各个节点上. 本节讨论 Dynamo 中出现的负载不平衡问题, 以及不同分区策略对负载分布的影响.</p><p>为了研究负载不平衡及其与请求负载的相关性, 我们测量了每个节点在 24 小时内收到的请求总数（分为 30 分钟的间隔）. 在给定的时间窗口内, 如果节点的请求负载与平均负载的偏差小于某个阈值（此处为 15%）, 则认为该节点“不平衡”. 否则, 该节点被视为“不平衡”. 图 6 显示了此时间段内“不平衡”节点的比例（以下简称“不平衡率”）. 作为参考, 还绘制了此时间段内整个系统收到的相应请求负载. 如图所示, 不平衡率随着负载的增加而降低. 例如, 在低负载期间, 不平衡率高达 20%, 而在高负载期间接近 10%. 直观地讲, 这可以解释为在高负载下, 大量常用键被访问, 并且由于键的均匀分布, 负载也均匀分布. 然而, 在低负载（负载为测量峰值负载的 1/8）期间, 访问的热门键较少, 导致负载不平衡程度更高.</p><p>本节讨论 Dynamo 的分区方案如何随着时间的推移而演变及其对负载分配的影响.</p><p>策略 1：每个节点分配 T 个随机令牌, 并按令牌值进行分区 ：这是生产环境中部署的初始策略（详见 4.2 节）. 在此方案中, 每个节点分配 T 个令牌（从哈希空间中均匀随机选择）. 所有节点的令牌均根据其在哈希空间中的值进行排序. 每两个连续的令牌定义一个范围. 最后一个令牌和第一个令牌构成一个范围, 该范围从哈希空间中的最高值“环绕”到最低值. 由于令牌是随机选择的, 因此范围的大小会有所不同. 随着节点加入和离开系统, 令牌集会发生变化, 范围也会随之变化. 需要注意的是, 维护每个节点成员资格所需的空间会随着系统中节点数量的增加而线性增加.</p><p>在使用此策略时, 遇到了以下问题. 首先, 当新节点加入系统时, 它需要从其他节点“窃取”其键范围. 然而, 将键范围交给新节点的节点必须扫描其本地持久化存储以检索相应的数据项集. 需要注意的是, 在生产节点上执行此类扫描操作非常棘手, 因为扫描是高度资源密集型操作, 并且需要在后台执行而不影响客户性能. 这要求我们以最低优先级运行引导任务. 然而, 这显著减慢了引导过程, 在繁忙的购物季节, 当节点每天处理数百万个请求时, 引导过程几乎需要一天才能完成. 其次, 当节点加入/离开系统时, 许多节点处理的键范围会发生变化, 需要重新计算新范围的默克尔树, 这在生产系统上执行起来并非易事. 最后, 由于键值范围的随机性, 很难对整个键值空间进行快照, 这使得归档过程变得复杂. 在该方案中, 归档整个键值空间需要我们从每个节点分别检索键值, 效率极低.</p><p>该策略的根本问题在于数据分区和数据放置方案相互交织. 例如, 在某些情况下, 为了应对不断增长的请求负载, 我们倾向于向系统添加更多节点. 然而, 在这种情况下, 添加节点不可能不影响数据分区. 理想情况下, 最好使用独立的分区和放置方案. 为此, 我们评估了以下策略：</p><p>策略 2：每个节点分配 T 个随机令牌, 并设置大小相等的分区： 在此策略中, 哈希空间被划分为 Q 个大小相等的分区/范围, 每个节点分配 T 个随机令牌. Q 通常设置为 Q = N 和 Q = S*T, 其中 S 是系统中的节点数. 在此策略中, 令牌仅用于构建将哈希空间中的值映射到有序节点列表的函数, 而不用于决定分区. 从分区末端顺时针遍历一致性哈希环时遇到的前 N ​​个唯一节点将被放置到该节点上. 图 7 展示了 N=3 时的此策略. 在此示例中, 从包含键 k1 的分区末端遍历环时会遇到节点 A、B、C. 此策略的主要优点是：(i) 分区与分区放置解耦, 以及 (ii) 能够在运行时更改放置方案.</p><p>策略 3：每个节点 Q/S 个令牌, 大小相等的分区： 与策略 2 类似, 此策略将哈希空间划分为 Q 个大小相等的分区, 并且分区的放置与分区方案无关. 此外, 每个节点分配有 Q/S 个令牌, 其中 S 是系统中的节点数. 当一个节点离开系统时, 其令牌会随机分配给剩余节点, 以保留这些属性. 同样, 当一个节点加入系统时, 它会以保留这些属性的方式从系统中的节点“窃取”令牌.</p><p>针对 S=30 和 N=3 的系统, 评估了这三种策略的效率. 然而, 公平地比较这些不同的策略并非易事, 因为不同的策略具有不同的配置来调整其效率. 例如, 策略 1 的负载分布属性取决于令牌数量（即 T）, 而策略 3 则取决于分区数量（即 Q）. 比较这些策略的一种公平方法是评估其负载分布的偏差, 同时所有策略都使用相同的空间来维护其成员信息. 例如, 在策略 1 中, 每个节点需要维护环中所有节点的令牌位置, 而在策略 3 中, 每个节点需要维护分配给每个节点的分区信息.</p><p>在我们的下一个实验中, 我们通过改变相关参数（T 和 Q）来评估这些策略. 我们针对每个节点需要维护的不同规模的成员信息, 测量了每种策略的负载均衡效率, 其中负载均衡效率定义为每个节点服务的平均请求数与最热节点服务的最大请求数之比.</p><p>结果如图 8 所示. 从图中可以看出, 策略 3 的负载均衡效率最高, 策略 2 的负载均衡效率最差. 在 Dynamo 实例从策略 1 迁移到策略 3 的过程中, 策略 2 曾短暂地充当过一个过渡阶段. 与策略 1 相比, 策略 3 的效率更高, 并且将每个节点维护的成员信息大小减少了三个数量级. 虽然存储不是主要问题, 但节点会定期交换成员信息, 因此最好尽可能保持这些信息的紧凑. 除此之外, 策略 3 还具有以下优势, 部署更简单：(i) 更快的引导/恢复： 由于分区范围是固定的, 它们可以存储在单独的文件中, 这意味着只需传输文件即可将分区作为一个单元进行重新定位（避免了定位特定项目所需的随机访问）. 这简化了引导和恢复的过程. （二） 易于归档 ：定期归档数据集是大多数亚马逊存储服务的强制性要求. 在策略 3 中, 归档 Dynamo 存储的整个数据集更为简单, 因为分区文件可以单独归档. 相比之下, 在策略 1 中, 令牌是随机选择的, 归档 Dynamo 中存储的数据需要分别从各个节点检索密钥, 这通常效率低下且速度缓慢. 策略 3 的缺点是, 更改节点成员身份需要协调, 以保留分配所需的属性.</p><h3 id="6-3-偏离的版本-何时以及有多少"><a class="header-anchor-1" href="#6-3-偏离的版本-何时以及有多少">#</a>6.3 偏离的版本: 何时以及有多少</h3><h3 id="6-4-客户端协调还是服务器协调"><a class="header-anchor-1" href="#6-4-客户端协调还是服务器协调">#</a>6.4 客户端协调还是服务器协调</h3><p>如第 5 节所述, Dynamo 有一个请求协调组件, 它使用状态机来处理传入的请求. 客户端请求由负载均衡器统一分配给环中的节点. 任何 Dynamo 节点都可以充当 get 请求的 Coordinator. 另一方面, put 请求将由键当前 Preference list 中的节点协调. 这种限制是由于这些优先节点还承担了创建新版本戳的额外责任, 该戳会因果地包含被写请求更新的版本. 需要注意的是, 如果 Dynamo 的版本控制方案基于物理时间戳, 则任何节点都可以协调写请求.</p><p>请求协调的另一种方法是将状态机移至客户端节点. 在此方案中, 客户端应用程序使用库在本地执行请求协调. 客户端会定期随机选择一个 Dynamo 节点, 并下载其当前的 Dynamo 成员状态视图. 使用此信息, 客户端可以确定哪些节点集合构成了任何给定键的 Preference list. 读取请求可以在客户端节点进行协调, 从而避免了负载均衡器将请求分配给随机 Dynamo 节点时产生的额外网络跃点. 写入操作将被转发到键的 Preference list 中的节点, 或者如果 Dynamo 使用基于时间戳的版本控制, 则可以在本地进行协调.</p><p>客户端驱动协调方法的一个重要优势是不再需要负载均衡器来均匀分配客户端负载. 通过将密钥近乎均匀地分配给存储节点, 可以隐式地保证公平的负载分配. 显然, 该方案的效率取决于客户端成员信息的新鲜度. 目前, 客户端每 10 秒轮询一个随机的 Dynamo 节点以获取成员更新. 选择基于拉取的方法而不是基于推送的方法, 因为前者在客户端数量较多的情况下扩展性更好, 并且只需要在服务器上维护很少的客户端状态. 然而, 在最坏的情况下, 客户端可能会在 10 秒内面临过时的成员信息. 如果客户端检测到其成员表已过时（例如, 当某些成员无法访问时）, 它将立即刷新其成员信息.</p><p>表 2 显示了与服务器驱动方法相比, 使用客户端驱动协调方法在 24 小时内观察到的 99.9 百分位和平均值的延迟改进. 从表中可以看出, 客户端驱动协调方法将 99.9 百分位延迟至少降低了 30 毫秒, 并将平均值降低了 3 到 4 毫秒. 延迟的改进是因为客户端驱动方法消除了负载均衡器的开销以及将请求分配给随机节点时可能产生的额外网络跃点. 从表中可以看出, 平均延迟往往明显低于 99.9 百分位的延迟. 这是因为 Dynamo 的存储引擎缓存和写缓冲区具有良好的命中率. 此外, 由于负载均衡器和网络为响应时间引入了额外的可变性, 因此 99.9 百分位的响应时间增益高于平均值.</p><h3 id="6-5-平衡后台任务与前台任务"><a class="header-anchor-1" href="#6-5-平衡后台任务与前台任务">#</a>6.5 平衡后台任务与前台任务</h3><p>除了正常的前台 put/get 操作外, 每个节点还执行不同类型的后台任务, 用于副本同步和数据交接（由于提示或添加/删除节点）. 在早期的生产设置中, 这些后台任务引发了资源争用问题, 并影响了常规 put 和 get 操作的性能. 因此, 有必要确保后台任务仅在常规关键操作不会受到显著影响时运行. 为此, 后台任务与<strong>准入控制机制</strong>集成. 每个后台任务都使用此控制器来预留资源（例如数据库）的运行时片段, 供所有后台任务共享. 采用基于对前台任务性能的监控的反馈机制来更改可供后台任务使用的片段数量.</p><p>准入控制器在执行前台 put/get 操作时, 会持续监控资源访问行为. 监控的方面包括磁盘操作的延迟、由于锁争用和事务超时导致的数据库访问失败, 以及请求队列等待时间. 这些信息用于检查给定尾随时间窗口内的延迟（或失败）百分位数是否接近期望阈值. 例如, 后台控制器会检查数据库读取的 p99 延迟（过去 60 秒内）与预设阈值（例如 50ms）的接近程度. 控制器使用此类比较来评估前台操作的资源可用性. 随后, 它会决定有多少时间片可供后台任务使用, 从而利用反馈回路来限制后台活动的侵入性. 需要注意的是, [4]中已经研究了类似的后台任务管理问题.</p><h3 id="6-6-讨论"><a class="header-anchor-1" href="#6-6-讨论">#</a>6.6 讨论</h3><p>本节总结了在实施和维护 Dynamo 过程中获得的一些经验. 过去两年, 许多 Amazon 内部服务都使用了 Dynamo, 它为其应用程序提供了相当高的可用性. 特别是, 应用程序对 99.9995% 的请求都收到了成功响应（没有超时）, 迄今为止没有发生过任何数据丢失事件.</p><p>此外, Dynamo 的主要优势在于它提供了必要的旋钮, 可以使用 (N, R, W) 三个参数来根据需求调整实例. 与流行的商业数据存储不同, Dynamo 将数据一致性和协调逻辑问题暴露给开发人员. 一开始, 人们可能会认为应用程序逻辑会更加复杂. 然而, 从历史上看, 亚马逊的平台是为高可用性而构建的, 许多应用程序的设计都考虑到了处理可能出现的各种故障模式和不一致性. 因此, 将这些应用程序移植到 Dynamo 是一个相对简单的任务. 对于想要使用 Dynamo 的新应用程序, 在开发的初始阶段需要进行一些分析, 以选择合适的冲突解决机制, 从而满足业务案例的需求. 最后, Dynamo 采用完全成员模型, 每个节点都知道其对等节点托管的数据. 为此, 每个节点都会主动与系统中的其他节点传播完整的路由表. 这种模型对于包含数百个节点的系统非常有效. 然而, 将这样的设计扩展到数万个节点并非易事, 因为维护路由表的开销会随着系统规模的增加而增加. 这一限制或许可以通过在 Dynamo 中引入分层扩展来克服. 另外, 值得注意的是, O(1) DHT 系统（例如 [14]）正在积极解决这个问题.</p><h2 id="7-结论"><a class="header-anchor-1" href="#7-结论">#</a>7. 结论</h2><p>本文介绍了 Dynamo, 一个高可用且可扩展的数据存储系统, 用于存储 <span class="exturl" data-url="aHR0cDovL0FtYXpvbi5jb20=">Amazon.com<i class="fa fa-external-link-alt"></i></span> 电商平台多项核心服务的状态. Dynamo 提供了所需的可用性和性能, 并成功应对了服务器故障、数据中心故障和网络分区. Dynamo 具有增量式可扩展性, 允许服务所有者根据当前请求负载进行扩展和缩减. Dynamo 允许服务所有者通过调整 N、R 和 W 参数来定制存储系统, 以满足其所需的性能、持久性和一致性 SLA.</p><p>Dynamo 在过去一年的生产环境中的应用表明, 分散式技术可以结合起来, 提供单一的高可用性系统. 它在最具挑战性的应用环境之一中的成功表明, 最终一致性存储系统可以成为高可用性应用程序的基石.</p><h2 id="参考资料"><a class="header-anchor-1" href="#参考资料">#</a>参考资料</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWxsdGhpbmdzZGlzdHJpYnV0ZWQuY29tLzIwMDcvMTAvYW1hem9uc19keW5hbW8uaHRtbA==">Amazon’s Dynamo (2007.10.2)<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>Dynamo 并不直接作为 Web 服务对外公开；但是, Dynamo 和类似的 Amazon 技术用于支持我们的 Amazon Web Services 的部分功能, 例如 S3.</p></blockquote><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWxsdGhpbmdzZGlzdHJpYnV0ZWQuY29tLzIwMTcvMTAvYS1kZWNhZGUtb2YtZHluYW1vLmh0bWw=">A Decade of Dynamo: Powering the next wave of high-performance, internet-scale applications (2017.10.2)<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>一切始于 2004 年, 当时亚马逊正在运行 Oracle 企业版, 并配备集群和复制功能. 我们拥有一支高级 DBA 团队, 并能与 Oracle 内部的顶级专家沟通. 我们当时正在突破当时领先的商业数据库的极限, 无法满足我们日益增长的亚马逊业务对可用性、可扩展性和性能的需求. 我们基于 Oracle 的数据库基础架构已不堪重负, 这促使我们评估能否开发一个能够长期支持我们业务需求的专用数据库. 我们优先考虑能够支持亚马逊购物车等大规模、关键任务服务的需求, 并质疑关系数据库传统上持有的假设, 例如对强一致性的要求. 我们的目标是构建一个拥有无限可扩展性、一致性能和高可用性的数据库, 以支持我们快速增长的业务需求. 深入研究我们现有数据库的使用情况后发现, 它们的关系功能经常被忽略. <em>大约 70% 的操作属于键值类型, 即仅使用主键并返回一行. 大约 20% 的操作会返回一组行, 但仍然只对单个表进行操作.</em> 考虑到这些需求, 并秉持着勇于挑战现状的理念, 一小群分布式系统专家齐聚一堂, 设计了一个可水平扩展的分布式数据库, 该数据库可以同时扩展读写能力, 以满足我们业务的长期需求. 这就是 Amazon Dynamo 数据库的起源. … Dynamo 的白皮书广受好评, 并成为创建分布式数据库技术类别（如今通常称为“NoSQL”）的催化剂.</p></blockquote><ul><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNDQ3ODk4OA==">论文笔记：[SOSP 2007] Dynamo: Amazon’s Highly Available Key-value Store<i class="fa fa-external-link-alt"></i></span></li></ul></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文博主：</strong> frezcirno</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/" title="[SOSP'07] Dynamo: Amazon’s Highly Available Key-value Store 论文阅读">https://frezcirno.github.io/2025/04/13/dynamo-amazons-highly-available-key-value-store/</a></li><li class="post-copyright-license"><strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" rel="tag"># 分布式系统</a> <a href="/tags/K-V-%E5%AD%98%E5%82%A8/" rel="tag"># K-V 存储</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2025/04/10/spdk-intro/" rel="prev" title="SPDK 入门"><i class="fa fa-angle-left"></i> SPDK 入门</a></div><div class="post-nav-item"><a href="/2025/04/13/dlmalloc/" rel="next" title="dlmalloc 内存分配器">dlmalloc 内存分配器<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">© 2020 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">frezcirno</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span title="站点总字数">180k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">10:55</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> &amp; <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"frezcirno/frezcirno.github.io","issue_term":"pathname","theme":"github-light"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/comments/utterances.min.js" defer></script><script>if(window.matchMedia("(min-width: 760px)").matches){var js=document.createElement("script");js.type="text/javascript",js.defer=!0,js.src="https://cdn.jsdelivr.net/gh/frezcirno/static/live2d-widget/autoload.js",document.head.append(js)}</script></body></html>